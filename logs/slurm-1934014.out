Resetting modules to system default. Reseting $MODULEPATH back to system default. All extra directories will be removed from $MODULEPATH.
no change     /apps/easybuild/software/tinkercliffs-rome_a100/Anaconda3/2022.05/condabin/conda
no change     /apps/easybuild/software/tinkercliffs-rome_a100/Anaconda3/2022.05/bin/conda
no change     /apps/easybuild/software/tinkercliffs-rome_a100/Anaconda3/2022.05/bin/conda-env
no change     /apps/easybuild/software/tinkercliffs-rome_a100/Anaconda3/2022.05/bin/activate
no change     /apps/easybuild/software/tinkercliffs-rome_a100/Anaconda3/2022.05/bin/deactivate
no change     /apps/easybuild/software/tinkercliffs-rome_a100/Anaconda3/2022.05/etc/profile.d/conda.sh
no change     /apps/easybuild/software/tinkercliffs-rome_a100/Anaconda3/2022.05/etc/fish/conf.d/conda.fish
no change     /apps/easybuild/software/tinkercliffs-rome_a100/Anaconda3/2022.05/shell/condabin/Conda.psm1
no change     /apps/easybuild/software/tinkercliffs-rome_a100/Anaconda3/2022.05/shell/condabin/conda-hook.ps1
no change     /apps/easybuild/software/tinkercliffs-rome_a100/Anaconda3/2022.05/lib/python3.9/site-packages/xontrib/conda.xsh
no change     /apps/easybuild/software/tinkercliffs-rome_a100/Anaconda3/2022.05/etc/profile.d/conda.csh
no change     /home/waris/.bashrc
No action taken.
/home/waris/.conda/envs/llm/lib/python3.11/site-packages/numpy/core/fromnumeric.py:59: FutureWarning: 'DataFrame.swapaxes' is deprecated and will be removed in a future version. Please use 'DataFrame.transpose' instead.
  return bound(*args, **kwds)
WARNING flwr 2024-01-09 18:15:10,974 | fedavg.py:117 | 
Setting `min_available_clients` lower than `min_fit_clients` or
`min_evaluate_clients` can cause the server to fail when there are too few clients
connected to the server. `min_available_clients` must be set to a value larger
than or equal to the values of `min_fit_clients` and `min_evaluate_clients`.

INFO flwr 2024-01-09 18:15:10,976 | app.py:178 | Starting Flower simulation, config: ServerConfig(num_rounds=30, round_timeout=None)
2024-01-09 18:15:14,472	INFO worker.py:1724 -- Started a local Ray instance.
INFO flwr 2024-01-09 18:15:16,063 | app.py:213 | Flower VCE: Ray initialized with resources: {'object_store_memory': 200000000000.0, 'node:10.128.9.202': 1.0, 'memory': 1152728570880.0, 'GPU': 4.0, 'accelerator_type:A100': 1.0, 'node:__internal_head__': 1.0, 'CPU': 32.0}
INFO flwr 2024-01-09 18:15:16,063 | app.py:219 | Optimize your simulation with Flower VCE: https://flower.dev/docs/framework/how-to-run-simulations.html
INFO flwr 2024-01-09 18:15:16,063 | app.py:242 | Flower VCE: Resources for each Virtual Client: {'num_cpus': 3, 'num_gpus': 1}
INFO flwr 2024-01-09 18:15:16,073 | app.py:288 | Flower VCE: Creating VirtualClientEngineActorPool with 4 actors
INFO flwr 2024-01-09 18:15:16,074 | server.py:89 | Initializing global parameters
INFO flwr 2024-01-09 18:15:16,074 | server.py:276 | Requesting initial parameters from one random client
INFO flwr 2024-01-09 18:15:25,376 | server.py:280 | Received initial parameters from one random client
INFO flwr 2024-01-09 18:15:25,376 | server.py:91 | Evaluating initial parameters
INFO flwr 2024-01-09 18:15:42,472 | server.py:94 | initial parameters (loss, other metrics): None, {'val_f1': 0.715, 'test_f1': 0.714, 'val_precision': 0.594, 'test_precision': 0.594, 'val_recall': 0.897, 'test_recall': 0.895, 'val_accuracy': 0.729, 'test_accuracy': 0.71}
INFO flwr 2024-01-09 18:15:42,473 | server.py:104 | FL starting
DEBUG flwr 2024-01-09 18:15:42,473 | server.py:222 | fit_round 1: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:16:35,166 | server.py:236 | fit_round 1 received 4 results and 0 failures
INFO flwr 2024-01-09 18:16:50,301 | server.py:125 | fit progress: (1, None, {'val_f1': 0.73, 'test_f1': 0.728, 'val_precision': 0.614, 'test_precision': 0.613, 'val_recall': 0.899, 'test_recall': 0.895, 'val_accuracy': 0.747, 'test_accuracy': 0.729}, 67.82813184615225)
INFO flwr 2024-01-09 18:16:50,302 | server.py:171 | evaluate_round 1: no clients selected, cancel
DEBUG flwr 2024-01-09 18:16:50,302 | server.py:222 | fit_round 2: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:17:37,369 | server.py:236 | fit_round 2 received 4 results and 0 failures
INFO flwr 2024-01-09 18:17:52,225 | server.py:125 | fit progress: (2, None, {'val_f1': 0.741, 'test_f1': 0.739, 'val_precision': 0.637, 'test_precision': 0.636, 'val_recall': 0.885, 'test_recall': 0.884, 'val_accuracy': 0.76, 'test_accuracy': 0.749}, 129.7517169378698)
INFO flwr 2024-01-09 18:17:52,226 | server.py:171 | evaluate_round 2: no clients selected, cancel
DEBUG flwr 2024-01-09 18:17:52,226 | server.py:222 | fit_round 3: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:18:40,418 | server.py:236 | fit_round 3 received 4 results and 0 failures
INFO flwr 2024-01-09 18:18:55,509 | server.py:125 | fit progress: (3, None, {'val_f1': 0.747, 'test_f1': 0.746, 'val_precision': 0.644, 'test_precision': 0.643, 'val_recall': 0.891, 'test_recall': 0.888, 'val_accuracy': 0.769, 'test_accuracy': 0.756}, 193.03588089440018)
INFO flwr 2024-01-09 18:18:55,510 | server.py:171 | evaluate_round 3: no clients selected, cancel
DEBUG flwr 2024-01-09 18:18:55,510 | server.py:222 | fit_round 4: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:19:43,477 | server.py:236 | fit_round 4 received 4 results and 0 failures
INFO flwr 2024-01-09 18:19:58,782 | server.py:125 | fit progress: (4, None, {'val_f1': 0.752, 'test_f1': 0.751, 'val_precision': 0.651, 'test_precision': 0.65, 'val_recall': 0.892, 'test_recall': 0.889, 'val_accuracy': 0.776, 'test_accuracy': 0.762}, 256.3082271674648)
INFO flwr 2024-01-09 18:19:58,782 | server.py:171 | evaluate_round 4: no clients selected, cancel
DEBUG flwr 2024-01-09 18:19:58,782 | server.py:222 | fit_round 5: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:20:47,910 | server.py:236 | fit_round 5 received 4 results and 0 failures
INFO flwr 2024-01-09 18:21:03,119 | server.py:125 | fit progress: (5, None, {'val_f1': 0.756, 'test_f1': 0.755, 'val_precision': 0.66, 'test_precision': 0.66, 'val_recall': 0.885, 'test_recall': 0.883, 'val_accuracy': 0.781, 'test_accuracy': 0.769}, 320.64526854176074)
INFO flwr 2024-01-09 18:21:03,119 | server.py:171 | evaluate_round 5: no clients selected, cancel
DEBUG flwr 2024-01-09 18:21:03,119 | server.py:222 | fit_round 6: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:21:52,628 | server.py:236 | fit_round 6 received 4 results and 0 failures
INFO flwr 2024-01-09 18:22:07,661 | server.py:125 | fit progress: (6, None, {'val_f1': 0.759, 'test_f1': 0.758, 'val_precision': 0.665, 'test_precision': 0.666, 'val_recall': 0.882, 'test_recall': 0.881, 'val_accuracy': 0.784, 'test_accuracy': 0.773}, 385.1872368454933)
INFO flwr 2024-01-09 18:22:07,661 | server.py:171 | evaluate_round 6: no clients selected, cancel
DEBUG flwr 2024-01-09 18:22:07,661 | server.py:222 | fit_round 7: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:22:57,194 | server.py:236 | fit_round 7 received 4 results and 0 failures
INFO flwr 2024-01-09 18:23:12,559 | server.py:125 | fit progress: (7, None, {'val_f1': 0.761, 'test_f1': 0.76, 'val_precision': 0.677, 'test_precision': 0.676, 'val_recall': 0.869, 'test_recall': 0.867, 'val_accuracy': 0.787, 'test_accuracy': 0.778}, 450.08548715990037)
INFO flwr 2024-01-09 18:23:12,560 | server.py:171 | evaluate_round 7: no clients selected, cancel
DEBUG flwr 2024-01-09 18:23:12,560 | server.py:222 | fit_round 8: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:24:01,659 | server.py:236 | fit_round 8 received 4 results and 0 failures
INFO flwr 2024-01-09 18:24:16,772 | server.py:125 | fit progress: (8, None, {'val_f1': 0.763, 'test_f1': 0.762, 'val_precision': 0.676, 'test_precision': 0.676, 'val_recall': 0.875, 'test_recall': 0.874, 'val_accuracy': 0.789, 'test_accuracy': 0.78}, 514.2987869568169)
INFO flwr 2024-01-09 18:24:16,773 | server.py:171 | evaluate_round 8: no clients selected, cancel
DEBUG flwr 2024-01-09 18:24:16,773 | server.py:222 | fit_round 9: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:25:04,657 | server.py:236 | fit_round 9 received 4 results and 0 failures
INFO flwr 2024-01-09 18:25:20,150 | server.py:125 | fit progress: (9, None, {'val_f1': 0.765, 'test_f1': 0.764, 'val_precision': 0.675, 'test_precision': 0.675, 'val_recall': 0.882, 'test_recall': 0.881, 'val_accuracy': 0.791, 'test_accuracy': 0.78}, 577.676737559028)
INFO flwr 2024-01-09 18:25:20,151 | server.py:171 | evaluate_round 9: no clients selected, cancel
DEBUG flwr 2024-01-09 18:25:20,151 | server.py:222 | fit_round 10: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:26:06,706 | server.py:236 | fit_round 10 received 4 results and 0 failures
INFO flwr 2024-01-09 18:26:21,793 | server.py:125 | fit progress: (10, None, {'val_f1': 0.766, 'test_f1': 0.765, 'val_precision': 0.683, 'test_precision': 0.682, 'val_recall': 0.872, 'test_recall': 0.871, 'val_accuracy': 0.793, 'test_accuracy': 0.784}, 639.3191728014499)
INFO flwr 2024-01-09 18:26:21,793 | server.py:171 | evaluate_round 10: no clients selected, cancel
DEBUG flwr 2024-01-09 18:26:21,793 | server.py:222 | fit_round 11: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:27:10,213 | server.py:236 | fit_round 11 received 4 results and 0 failures
INFO flwr 2024-01-09 18:27:25,103 | server.py:125 | fit progress: (11, None, {'val_f1': 0.767, 'test_f1': 0.766, 'val_precision': 0.684, 'test_precision': 0.683, 'val_recall': 0.874, 'test_recall': 0.872, 'val_accuracy': 0.794, 'test_accuracy': 0.785}, 702.6291921930388)
INFO flwr 2024-01-09 18:27:25,103 | server.py:171 | evaluate_round 11: no clients selected, cancel
DEBUG flwr 2024-01-09 18:27:25,103 | server.py:222 | fit_round 12: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:28:14,835 | server.py:236 | fit_round 12 received 4 results and 0 failures
INFO flwr 2024-01-09 18:28:29,745 | server.py:125 | fit progress: (12, None, {'val_f1': 0.768, 'test_f1': 0.768, 'val_precision': 0.678, 'test_precision': 0.678, 'val_recall': 0.887, 'test_recall': 0.885, 'val_accuracy': 0.795, 'test_accuracy': 0.784}, 767.2717418279499)
INFO flwr 2024-01-09 18:28:29,746 | server.py:171 | evaluate_round 12: no clients selected, cancel
DEBUG flwr 2024-01-09 18:28:29,746 | server.py:222 | fit_round 13: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:29:18,895 | server.py:236 | fit_round 13 received 4 results and 0 failures
INFO flwr 2024-01-09 18:29:33,896 | server.py:125 | fit progress: (13, None, {'val_f1': 0.77, 'test_f1': 0.769, 'val_precision': 0.678, 'test_precision': 0.677, 'val_recall': 0.89, 'test_recall': 0.888, 'val_accuracy': 0.796, 'test_accuracy': 0.784}, 831.4223694223911)
INFO flwr 2024-01-09 18:29:33,899 | server.py:171 | evaluate_round 13: no clients selected, cancel
DEBUG flwr 2024-01-09 18:29:33,899 | server.py:222 | fit_round 14: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:30:21,277 | server.py:236 | fit_round 14 received 4 results and 0 failures
INFO flwr 2024-01-09 18:30:36,201 | server.py:125 | fit progress: (14, None, {'val_f1': 0.77, 'test_f1': 0.769, 'val_precision': 0.679, 'test_precision': 0.678, 'val_recall': 0.891, 'test_recall': 0.889, 'val_accuracy': 0.797, 'test_accuracy': 0.784}, 893.7273678816855)
INFO flwr 2024-01-09 18:30:36,201 | server.py:171 | evaluate_round 14: no clients selected, cancel
DEBUG flwr 2024-01-09 18:30:36,201 | server.py:222 | fit_round 15: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:31:25,366 | server.py:236 | fit_round 15 received 4 results and 0 failures
INFO flwr 2024-01-09 18:31:39,714 | server.py:125 | fit progress: (15, None, {'val_f1': 0.772, 'test_f1': 0.769, 'val_precision': 0.677, 'test_precision': 0.675, 'val_recall': 0.897, 'test_recall': 0.894, 'val_accuracy': 0.798, 'test_accuracy': 0.784}, 957.2409226251766)
INFO flwr 2024-01-09 18:31:39,715 | server.py:171 | evaluate_round 15: no clients selected, cancel
DEBUG flwr 2024-01-09 18:31:39,715 | server.py:222 | fit_round 16: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:32:27,181 | server.py:236 | fit_round 16 received 4 results and 0 failures
INFO flwr 2024-01-09 18:32:41,683 | server.py:125 | fit progress: (16, None, {'val_f1': 0.773, 'test_f1': 0.771, 'val_precision': 0.68, 'test_precision': 0.679, 'val_recall': 0.894, 'test_recall': 0.891, 'val_accuracy': 0.799, 'test_accuracy': 0.786}, 1019.2092149788514)
INFO flwr 2024-01-09 18:32:41,683 | server.py:171 | evaluate_round 16: no clients selected, cancel
DEBUG flwr 2024-01-09 18:32:41,683 | server.py:222 | fit_round 17: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:33:30,149 | server.py:236 | fit_round 17 received 4 results and 0 failures
INFO flwr 2024-01-09 18:33:44,235 | server.py:125 | fit progress: (17, None, {'val_f1': 0.774, 'test_f1': 0.772, 'val_precision': 0.687, 'test_precision': 0.686, 'val_recall': 0.886, 'test_recall': 0.884, 'val_accuracy': 0.8, 'test_accuracy': 0.79}, 1081.76146459952)
INFO flwr 2024-01-09 18:33:44,235 | server.py:171 | evaluate_round 17: no clients selected, cancel
DEBUG flwr 2024-01-09 18:33:44,236 | server.py:222 | fit_round 18: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:34:32,109 | server.py:236 | fit_round 18 received 4 results and 0 failures
INFO flwr 2024-01-09 18:34:46,418 | server.py:125 | fit progress: (18, None, {'val_f1': 0.774, 'test_f1': 0.773, 'val_precision': 0.689, 'test_precision': 0.688, 'val_recall': 0.885, 'test_recall': 0.882, 'val_accuracy': 0.801, 'test_accuracy': 0.791}, 1143.944650544785)
INFO flwr 2024-01-09 18:34:46,419 | server.py:171 | evaluate_round 18: no clients selected, cancel
DEBUG flwr 2024-01-09 18:34:46,419 | server.py:222 | fit_round 19: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:35:36,014 | server.py:236 | fit_round 19 received 4 results and 0 failures
INFO flwr 2024-01-09 18:35:50,770 | server.py:125 | fit progress: (19, None, {'val_f1': 0.775, 'test_f1': 0.773, 'val_precision': 0.698, 'test_precision': 0.696, 'val_recall': 0.871, 'test_recall': 0.869, 'val_accuracy': 0.802, 'test_accuracy': 0.794}, 1208.296562193893)
INFO flwr 2024-01-09 18:35:50,772 | server.py:171 | evaluate_round 19: no clients selected, cancel
DEBUG flwr 2024-01-09 18:35:50,772 | server.py:222 | fit_round 20: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:36:39,961 | server.py:236 | fit_round 20 received 4 results and 0 failures
INFO flwr 2024-01-09 18:36:54,992 | server.py:125 | fit progress: (20, None, {'val_f1': 0.776, 'test_f1': 0.774, 'val_precision': 0.689, 'test_precision': 0.688, 'val_recall': 0.888, 'test_recall': 0.885, 'val_accuracy': 0.803, 'test_accuracy': 0.792}, 1272.5182095896453)
INFO flwr 2024-01-09 18:36:54,992 | server.py:171 | evaluate_round 20: no clients selected, cancel
DEBUG flwr 2024-01-09 18:36:54,993 | server.py:222 | fit_round 21: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:37:44,135 | server.py:236 | fit_round 21 received 4 results and 0 failures
INFO flwr 2024-01-09 18:37:59,006 | server.py:125 | fit progress: (21, None, {'val_f1': 0.776, 'test_f1': 0.775, 'val_precision': 0.689, 'test_precision': 0.687, 'val_recall': 0.889, 'test_recall': 0.888, 'val_accuracy': 0.803, 'test_accuracy': 0.792}, 1336.532734632492)
INFO flwr 2024-01-09 18:37:59,007 | server.py:171 | evaluate_round 21: no clients selected, cancel
DEBUG flwr 2024-01-09 18:37:59,007 | server.py:222 | fit_round 22: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:38:49,132 | server.py:236 | fit_round 22 received 4 results and 0 failures
INFO flwr 2024-01-09 18:39:04,101 | server.py:125 | fit progress: (22, None, {'val_f1': 0.777, 'test_f1': 0.774, 'val_precision': 0.686, 'test_precision': 0.685, 'val_recall': 0.895, 'test_recall': 0.891, 'val_accuracy': 0.803, 'test_accuracy': 0.79}, 1401.6277264123783)
INFO flwr 2024-01-09 18:39:04,102 | server.py:171 | evaluate_round 22: no clients selected, cancel
DEBUG flwr 2024-01-09 18:39:04,102 | server.py:222 | fit_round 23: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:39:54,626 | server.py:236 | fit_round 23 received 4 results and 0 failures
INFO flwr 2024-01-09 18:40:08,838 | server.py:125 | fit progress: (23, None, {'val_f1': 0.777, 'test_f1': 0.776, 'val_precision': 0.699, 'test_precision': 0.698, 'val_recall': 0.875, 'test_recall': 0.873, 'val_accuracy': 0.804, 'test_accuracy': 0.796}, 1466.364778574556)
INFO flwr 2024-01-09 18:40:08,839 | server.py:171 | evaluate_round 23: no clients selected, cancel
DEBUG flwr 2024-01-09 18:40:08,839 | server.py:222 | fit_round 24: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:40:58,036 | server.py:236 | fit_round 24 received 4 results and 0 failures
INFO flwr 2024-01-09 18:41:12,357 | server.py:125 | fit progress: (24, None, {'val_f1': 0.777, 'test_f1': 0.775, 'val_precision': 0.686, 'test_precision': 0.684, 'val_recall': 0.896, 'test_recall': 0.893, 'val_accuracy': 0.804, 'test_accuracy': 0.79}, 1529.8834075909108)
INFO flwr 2024-01-09 18:41:12,357 | server.py:171 | evaluate_round 24: no clients selected, cancel
DEBUG flwr 2024-01-09 18:41:12,357 | server.py:222 | fit_round 25: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:42:00,352 | server.py:236 | fit_round 25 received 4 results and 0 failures
INFO flwr 2024-01-09 18:42:14,592 | server.py:125 | fit progress: (25, None, {'val_f1': 0.778, 'test_f1': 0.777, 'val_precision': 0.705, 'test_precision': 0.704, 'val_recall': 0.868, 'test_recall': 0.866, 'val_accuracy': 0.805, 'test_accuracy': 0.799}, 1592.1187293222174)
INFO flwr 2024-01-09 18:42:14,593 | server.py:171 | evaluate_round 25: no clients selected, cancel
DEBUG flwr 2024-01-09 18:42:14,593 | server.py:222 | fit_round 26: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:43:03,827 | server.py:236 | fit_round 26 received 4 results and 0 failures
INFO flwr 2024-01-09 18:43:18,454 | server.py:125 | fit progress: (26, None, {'val_f1': 0.778, 'test_f1': 0.777, 'val_precision': 0.703, 'test_precision': 0.702, 'val_recall': 0.872, 'test_recall': 0.87, 'val_accuracy': 0.806, 'test_accuracy': 0.799}, 1655.980212341994)
INFO flwr 2024-01-09 18:43:18,455 | server.py:171 | evaluate_round 26: no clients selected, cancel
DEBUG flwr 2024-01-09 18:43:18,455 | server.py:222 | fit_round 27: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:44:06,624 | server.py:236 | fit_round 27 received 4 results and 0 failures
INFO flwr 2024-01-09 18:44:21,472 | server.py:125 | fit progress: (27, None, {'val_f1': 0.779, 'test_f1': 0.778, 'val_precision': 0.706, 'test_precision': 0.705, 'val_recall': 0.869, 'test_recall': 0.868, 'val_accuracy': 0.806, 'test_accuracy': 0.8}, 1718.9988947100937)
INFO flwr 2024-01-09 18:44:21,473 | server.py:171 | evaluate_round 27: no clients selected, cancel
DEBUG flwr 2024-01-09 18:44:21,473 | server.py:222 | fit_round 28: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:45:09,918 | server.py:236 | fit_round 28 received 4 results and 0 failures
INFO flwr 2024-01-09 18:45:24,617 | server.py:125 | fit progress: (28, None, {'val_f1': 0.779, 'test_f1': 0.778, 'val_precision': 0.704, 'test_precision': 0.703, 'val_recall': 0.872, 'test_recall': 0.871, 'val_accuracy': 0.806, 'test_accuracy': 0.799}, 1782.1436464572325)
INFO flwr 2024-01-09 18:45:24,618 | server.py:171 | evaluate_round 28: no clients selected, cancel
DEBUG flwr 2024-01-09 18:45:24,618 | server.py:222 | fit_round 29: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:46:12,516 | server.py:236 | fit_round 29 received 4 results and 0 failures
INFO flwr 2024-01-09 18:46:27,502 | server.py:125 | fit progress: (29, None, {'val_f1': 0.779, 'test_f1': 0.779, 'val_precision': 0.705, 'test_precision': 0.704, 'val_recall': 0.872, 'test_recall': 0.871, 'val_accuracy': 0.807, 'test_accuracy': 0.8}, 1845.0283470461145)
INFO flwr 2024-01-09 18:46:27,502 | server.py:171 | evaluate_round 29: no clients selected, cancel
DEBUG flwr 2024-01-09 18:46:27,502 | server.py:222 | fit_round 30: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:47:15,265 | server.py:236 | fit_round 30 received 4 results and 0 failures
INFO flwr 2024-01-09 18:47:30,155 | server.py:125 | fit progress: (30, None, {'val_f1': 0.78, 'test_f1': 0.779, 'val_precision': 0.705, 'test_precision': 0.705, 'val_recall': 0.872, 'test_recall': 0.871, 'val_accuracy': 0.807, 'test_accuracy': 0.801}, 1907.6817888058722)
INFO flwr 2024-01-09 18:47:30,156 | server.py:171 | evaluate_round 30: no clients selected, cancel
INFO flwr 2024-01-09 18:47:30,156 | server.py:153 | FL finished in 1907.6825731098652
INFO flwr 2024-01-09 18:47:30,159 | app.py:226 | app_fit: losses_distributed []
INFO flwr 2024-01-09 18:47:30,159 | app.py:227 | app_fit: metrics_distributed_fit {'avg_cval': [(1, {'F1': 0.7184, 'Precision': 0.613, 'Recall': 0.8688, 'Threshold': 0.7447}), (2, {'F1': 0.725, 'Precision': 0.622, 'Recall': 0.8719, 'Threshold': 0.7487}), (3, {'F1': 0.7415, 'Precision': 0.648, 'Recall': 0.8704, 'Threshold': 0.7542}), (4, {'F1': 0.7333, 'Precision': 0.6301, 'Recall': 0.8796, 'Threshold': 0.7513}), (5, {'F1': 0.738, 'Precision': 0.6391, 'Recall': 0.875, 'Threshold': 0.7563}), (6, {'F1': 0.7398, 'Precision': 0.6348, 'Recall': 0.8873, 'Threshold': 0.7494}), (7, {'F1': 0.7379, 'Precision': 0.6377, 'Recall': 0.8773, 'Threshold': 0.7504}), (8, {'F1': 0.7526, 'Precision': 0.652, 'Recall': 0.8912, 'Threshold': 0.7369}), (9, {'F1': 0.7422, 'Precision': 0.6473, 'Recall': 0.8719, 'Threshold': 0.7548}), (10, {'F1': 0.7497, 'Precision': 0.6545, 'Recall': 0.8781, 'Threshold': 0.7509}), (11, {'F1': 0.7444, 'Precision': 0.6374, 'Recall': 0.8951, 'Threshold': 0.7374}), (12, {'F1': 0.7376, 'Precision': 0.6444, 'Recall': 0.8634, 'Threshold': 0.7531}), (13, {'F1': 0.745, 'Precision': 0.6544, 'Recall': 0.8657, 'Threshold': 0.7585}), (14, {'F1': 0.7496, 'Precision': 0.6758, 'Recall': 0.8488, 'Threshold': 0.7662}), (15, {'F1': 0.7507, 'Precision': 0.7019, 'Recall': 0.811, 'Threshold': 0.7915}), (16, {'F1': 0.7536, 'Precision': 0.6671, 'Recall': 0.8673, 'Threshold': 0.7542}), (17, {'F1': 0.7467, 'Precision': 0.6549, 'Recall': 0.8704, 'Threshold': 0.751}), (18, {'F1': 0.7617, 'Precision': 0.6782, 'Recall': 0.8704, 'Threshold': 0.7544}), (19, {'F1': 0.7568, 'Precision': 0.6876, 'Recall': 0.8426, 'Threshold': 0.7662}), (20, {'F1': 0.7515, 'Precision': 0.659, 'Recall': 0.8758, 'Threshold': 0.75}), (21, {'F1': 0.7447, 'Precision': 0.6485, 'Recall': 0.8758, 'Threshold': 0.7391}), (22, {'F1': 0.7575, 'Precision': 0.6972, 'Recall': 0.8349, 'Threshold': 0.7743}), (23, {'F1': 0.7546, 'Precision': 0.6903, 'Recall': 0.8395, 'Threshold': 0.7681}), (24, {'F1': 0.7508, 'Precision': 0.6796, 'Recall': 0.8395, 'Threshold': 0.766}), (25, {'F1': 0.7562, 'Precision': 0.6704, 'Recall': 0.8673, 'Threshold': 0.7559}), (26, {'F1': 0.7544, 'Precision': 0.6977, 'Recall': 0.8241, 'Threshold': 0.7802}), (27, {'F1': 0.7627, 'Precision': 0.6656, 'Recall': 0.8935, 'Threshold': 0.7377}), (28, {'F1': 0.7528, 'Precision': 0.6832, 'Recall': 0.8403, 'Threshold': 0.7695}), (29, {'F1': 0.7557, 'Precision': 0.6723, 'Recall': 0.8642, 'Threshold': 0.7447}), (30, {'F1': 0.7566, 'Precision': 0.6663, 'Recall': 0.8758, 'Threshold': 0.7445})], 'avg_ctest': [(1, {'F1': 0.7113, 'Precision': 0.6126, 'Recall': 0.8495, 'Threshold': 0.7447}), (2, {'F1': 0.7078, 'Precision': 0.6052, 'Recall': 0.8549, 'Threshold': 0.7487}), (3, {'F1': 0.7173, 'Precision': 0.631, 'Recall': 0.8333, 'Threshold': 0.7542}), (4, {'F1': 0.7135, 'Precision': 0.6206, 'Recall': 0.841, 'Threshold': 0.7513}), (5, {'F1': 0.7172, 'Precision': 0.6294, 'Recall': 0.8349, 'Threshold': 0.7563}), (6, {'F1': 0.7309, 'Precision': 0.6354, 'Recall': 0.8618, 'Threshold': 0.7494}), (7, {'F1': 0.7333, 'Precision': 0.633, 'Recall': 0.8727, 'Threshold': 0.7504}), (8, {'F1': 0.729, 'Precision': 0.6277, 'Recall': 0.8704, 'Threshold': 0.7369}), (9, {'F1': 0.7335, 'Precision': 0.6468, 'Recall': 0.8503, 'Threshold': 0.7548}), (10, {'F1': 0.7384, 'Precision': 0.6455, 'Recall': 0.8642, 'Threshold': 0.7509}), (11, {'F1': 0.7406, 'Precision': 0.6394, 'Recall': 0.8812, 'Threshold': 0.7374}), (12, {'F1': 0.7374, 'Precision': 0.6444, 'Recall': 0.8619, 'Threshold': 0.7531}), (13, {'F1': 0.7447, 'Precision': 0.6639, 'Recall': 0.8494, 'Threshold': 0.7585}), (14, {'F1': 0.7344, 'Precision': 0.6642, 'Recall': 0.8272, 'Threshold': 0.7662}), (15, {'F1': 0.7237, 'Precision': 0.6789, 'Recall': 0.777, 'Threshold': 0.7915}), (16, {'F1': 0.7462, 'Precision': 0.6622, 'Recall': 0.8565, 'Threshold': 0.7542}), (17, {'F1': 0.7435, 'Precision': 0.6529, 'Recall': 0.865, 'Threshold': 0.751}), (18, {'F1': 0.7413, 'Precision': 0.6602, 'Recall': 0.8465, 'Threshold': 0.7544}), (19, {'F1': 0.7348, 'Precision': 0.6594, 'Recall': 0.8318, 'Threshold': 0.7662}), (20, {'F1': 0.7465, 'Precision': 0.6593, 'Recall': 0.8634, 'Threshold': 0.75}), (21, {'F1': 0.7469, 'Precision': 0.6508, 'Recall': 0.8781, 'Threshold': 0.7391}), (22, {'F1': 0.7453, 'Precision': 0.6911, 'Recall': 0.8133, 'Threshold': 0.7743}), (23, {'F1': 0.7423, 'Precision': 0.6776, 'Recall': 0.8272, 'Threshold': 0.7681}), (24, {'F1': 0.7545, 'Precision': 0.6824, 'Recall': 0.8448, 'Threshold': 0.766}), (25, {'F1': 0.7488, 'Precision': 0.6696, 'Recall': 0.8503, 'Threshold': 0.7559}), (26, {'F1': 0.7371, 'Precision': 0.6848, 'Recall': 0.8002, 'Threshold': 0.7802}), (27, {'F1': 0.7477, 'Precision': 0.6585, 'Recall': 0.8657, 'Threshold': 0.7377}), (28, {'F1': 0.7427, 'Precision': 0.676, 'Recall': 0.8248, 'Threshold': 0.7695}), (29, {'F1': 0.7535, 'Precision': 0.6671, 'Recall': 0.8681, 'Threshold': 0.7447}), (30, {'F1': 0.754, 'Precision': 0.6641, 'Recall': 0.8727, 'Threshold': 0.7445})]}
INFO flwr 2024-01-09 18:47:30,159 | app.py:228 | app_fit: metrics_distributed {}
INFO flwr 2024-01-09 18:47:30,159 | app.py:229 | app_fit: losses_centralized [(0, None), (1, None), (2, None), (3, None), (4, None), (5, None), (6, None), (7, None), (8, None), (9, None), (10, None), (11, None), (12, None), (13, None), (14, None), (15, None), (16, None), (17, None), (18, None), (19, None), (20, None), (21, None), (22, None), (23, None), (24, None), (25, None), (26, None), (27, None), (28, None), (29, None), (30, None)]
INFO flwr 2024-01-09 18:47:30,160 | app.py:230 | app_fit: metrics_centralized {'val_f1': [(0, 0.715), (1, 0.73), (2, 0.741), (3, 0.747), (4, 0.752), (5, 0.756), (6, 0.759), (7, 0.761), (8, 0.763), (9, 0.765), (10, 0.766), (11, 0.767), (12, 0.768), (13, 0.77), (14, 0.77), (15, 0.772), (16, 0.773), (17, 0.774), (18, 0.774), (19, 0.775), (20, 0.776), (21, 0.776), (22, 0.777), (23, 0.777), (24, 0.777), (25, 0.778), (26, 0.778), (27, 0.779), (28, 0.779), (29, 0.779), (30, 0.78)], 'test_f1': [(0, 0.714), (1, 0.728), (2, 0.739), (3, 0.746), (4, 0.751), (5, 0.755), (6, 0.758), (7, 0.76), (8, 0.762), (9, 0.764), (10, 0.765), (11, 0.766), (12, 0.768), (13, 0.769), (14, 0.769), (15, 0.769), (16, 0.771), (17, 0.772), (18, 0.773), (19, 0.773), (20, 0.774), (21, 0.775), (22, 0.774), (23, 0.776), (24, 0.775), (25, 0.777), (26, 0.777), (27, 0.778), (28, 0.778), (29, 0.779), (30, 0.779)], 'val_precision': [(0, 0.594), (1, 0.614), (2, 0.637), (3, 0.644), (4, 0.651), (5, 0.66), (6, 0.665), (7, 0.677), (8, 0.676), (9, 0.675), (10, 0.683), (11, 0.684), (12, 0.678), (13, 0.678), (14, 0.679), (15, 0.677), (16, 0.68), (17, 0.687), (18, 0.689), (19, 0.698), (20, 0.689), (21, 0.689), (22, 0.686), (23, 0.699), (24, 0.686), (25, 0.705), (26, 0.703), (27, 0.706), (28, 0.704), (29, 0.705), (30, 0.705)], 'test_precision': [(0, 0.594), (1, 0.613), (2, 0.636), (3, 0.643), (4, 0.65), (5, 0.66), (6, 0.666), (7, 0.676), (8, 0.676), (9, 0.675), (10, 0.682), (11, 0.683), (12, 0.678), (13, 0.677), (14, 0.678), (15, 0.675), (16, 0.679), (17, 0.686), (18, 0.688), (19, 0.696), (20, 0.688), (21, 0.687), (22, 0.685), (23, 0.698), (24, 0.684), (25, 0.704), (26, 0.702), (27, 0.705), (28, 0.703), (29, 0.704), (30, 0.705)], 'val_recall': [(0, 0.897), (1, 0.899), (2, 0.885), (3, 0.891), (4, 0.892), (5, 0.885), (6, 0.882), (7, 0.869), (8, 0.875), (9, 0.882), (10, 0.872), (11, 0.874), (12, 0.887), (13, 0.89), (14, 0.891), (15, 0.897), (16, 0.894), (17, 0.886), (18, 0.885), (19, 0.871), (20, 0.888), (21, 0.889), (22, 0.895), (23, 0.875), (24, 0.896), (25, 0.868), (26, 0.872), (27, 0.869), (28, 0.872), (29, 0.872), (30, 0.872)], 'test_recall': [(0, 0.895), (1, 0.895), (2, 0.884), (3, 0.888), (4, 0.889), (5, 0.883), (6, 0.881), (7, 0.867), (8, 0.874), (9, 0.881), (10, 0.871), (11, 0.872), (12, 0.885), (13, 0.888), (14, 0.889), (15, 0.894), (16, 0.891), (17, 0.884), (18, 0.882), (19, 0.869), (20, 0.885), (21, 0.888), (22, 0.891), (23, 0.873), (24, 0.893), (25, 0.866), (26, 0.87), (27, 0.868), (28, 0.871), (29, 0.871), (30, 0.871)], 'val_accuracy': [(0, 0.729), (1, 0.747), (2, 0.76), (3, 0.769), (4, 0.776), (5, 0.781), (6, 0.784), (7, 0.787), (8, 0.789), (9, 0.791), (10, 0.793), (11, 0.794), (12, 0.795), (13, 0.796), (14, 0.797), (15, 0.798), (16, 0.799), (17, 0.8), (18, 0.801), (19, 0.802), (20, 0.803), (21, 0.803), (22, 0.803), (23, 0.804), (24, 0.804), (25, 0.805), (26, 0.806), (27, 0.806), (28, 0.806), (29, 0.807), (30, 0.807)], 'test_accuracy': [(0, 0.71), (1, 0.729), (2, 0.749), (3, 0.756), (4, 0.762), (5, 0.769), (6, 0.773), (7, 0.778), (8, 0.78), (9, 0.78), (10, 0.784), (11, 0.785), (12, 0.784), (13, 0.784), (14, 0.784), (15, 0.784), (16, 0.786), (17, 0.79), (18, 0.791), (19, 0.794), (20, 0.792), (21, 0.792), (22, 0.79), (23, 0.796), (24, 0.79), (25, 0.799), (26, 0.799), (27, 0.8), (28, 0.799), (29, 0.8), (30, 0.801)]}
Starting Simulation ..
> Hit: Dataset Distribution found in cache: quora-20-412
Experiment Key: tname-paraphrase-MiniLM-L3-v2-dname-quora-clients_per_round-4-num_clients-20-batch_size-412-device-cuda-client_epochs-6-num_rounds-30-
> Starting Simulation ..
avg_cval: {'F1': 0.7184, 'Precision': 0.613, 'Recall': 0.8688, 'Threshold': 0.7447}
avg_ctest: {'F1': 0.7113, 'Precision': 0.6126, 'Recall': 0.8495, 'Threshold': 0.7447}
avg_cval: {'F1': 0.725, 'Precision': 0.622, 'Recall': 0.8719, 'Threshold': 0.7487}
avg_ctest: {'F1': 0.7078, 'Precision': 0.6052, 'Recall': 0.8549, 'Threshold': 0.7487}
avg_cval: {'F1': 0.7415, 'Precision': 0.648, 'Recall': 0.8704, 'Threshold': 0.7542}
avg_ctest: {'F1': 0.7173, 'Precision': 0.631, 'Recall': 0.8333, 'Threshold': 0.7542}
avg_cval: {'F1': 0.7333, 'Precision': 0.6301, 'Recall': 0.8796, 'Threshold': 0.7513}
avg_ctest: {'F1': 0.7135, 'Precision': 0.6206, 'Recall': 0.841, 'Threshold': 0.7513}
avg_cval: {'F1': 0.738, 'Precision': 0.6391, 'Recall': 0.875, 'Threshold': 0.7563}
avg_ctest: {'F1': 0.7172, 'Precision': 0.6294, 'Recall': 0.8349, 'Threshold': 0.7563}
avg_cval: {'F1': 0.7398, 'Precision': 0.6348, 'Recall': 0.8873, 'Threshold': 0.7494}
avg_ctest: {'F1': 0.7309, 'Precision': 0.6354, 'Recall': 0.8618, 'Threshold': 0.7494}
avg_cval: {'F1': 0.7379, 'Precision': 0.6377, 'Recall': 0.8773, 'Threshold': 0.7504}
avg_ctest: {'F1': 0.7333, 'Precision': 0.633, 'Recall': 0.8727, 'Threshold': 0.7504}
avg_cval: {'F1': 0.7526, 'Precision': 0.652, 'Recall': 0.8912, 'Threshold': 0.7369}
avg_ctest: {'F1': 0.729, 'Precision': 0.6277, 'Recall': 0.8704, 'Threshold': 0.7369}
avg_cval: {'F1': 0.7422, 'Precision': 0.6473, 'Recall': 0.8719, 'Threshold': 0.7548}
avg_ctest: {'F1': 0.7335, 'Precision': 0.6468, 'Recall': 0.8503, 'Threshold': 0.7548}
avg_cval: {'F1': 0.7497, 'Precision': 0.6545, 'Recall': 0.8781, 'Threshold': 0.7509}
avg_ctest: {'F1': 0.7384, 'Precision': 0.6455, 'Recall': 0.8642, 'Threshold': 0.7509}
avg_cval: {'F1': 0.7444, 'Precision': 0.6374, 'Recall': 0.8951, 'Threshold': 0.7374}
avg_ctest: {'F1': 0.7406, 'Precision': 0.6394, 'Recall': 0.8812, 'Threshold': 0.7374}
avg_cval: {'F1': 0.7376, 'Precision': 0.6444, 'Recall': 0.8634, 'Threshold': 0.7531}
avg_ctest: {'F1': 0.7374, 'Precision': 0.6444, 'Recall': 0.8619, 'Threshold': 0.7531}
avg_cval: {'F1': 0.745, 'Precision': 0.6544, 'Recall': 0.8657, 'Threshold': 0.7585}
avg_ctest: {'F1': 0.7447, 'Precision': 0.6639, 'Recall': 0.8494, 'Threshold': 0.7585}
avg_cval: {'F1': 0.7496, 'Precision': 0.6758, 'Recall': 0.8488, 'Threshold': 0.7662}
avg_ctest: {'F1': 0.7344, 'Precision': 0.6642, 'Recall': 0.8272, 'Threshold': 0.7662}
avg_cval: {'F1': 0.7507, 'Precision': 0.7019, 'Recall': 0.811, 'Threshold': 0.7915}
avg_ctest: {'F1': 0.7237, 'Precision': 0.6789, 'Recall': 0.777, 'Threshold': 0.7915}
avg_cval: {'F1': 0.7536, 'Precision': 0.6671, 'Recall': 0.8673, 'Threshold': 0.7542}
avg_ctest: {'F1': 0.7462, 'Precision': 0.6622, 'Recall': 0.8565, 'Threshold': 0.7542}
avg_cval: {'F1': 0.7467, 'Precision': 0.6549, 'Recall': 0.8704, 'Threshold': 0.751}
avg_ctest: {'F1': 0.7435, 'Precision': 0.6529, 'Recall': 0.865, 'Threshold': 0.751}
avg_cval: {'F1': 0.7617, 'Precision': 0.6782, 'Recall': 0.8704, 'Threshold': 0.7544}
avg_ctest: {'F1': 0.7413, 'Precision': 0.6602, 'Recall': 0.8465, 'Threshold': 0.7544}
avg_cval: {'F1': 0.7568, 'Precision': 0.6876, 'Recall': 0.8426, 'Threshold': 0.7662}
avg_ctest: {'F1': 0.7348, 'Precision': 0.6594, 'Recall': 0.8318, 'Threshold': 0.7662}
avg_cval: {'F1': 0.7515, 'Precision': 0.659, 'Recall': 0.8758, 'Threshold': 0.75}
avg_ctest: {'F1': 0.7465, 'Precision': 0.6593, 'Recall': 0.8634, 'Threshold': 0.75}
avg_cval: {'F1': 0.7447, 'Precision': 0.6485, 'Recall': 0.8758, 'Threshold': 0.7391}
avg_ctest: {'F1': 0.7469, 'Precision': 0.6508, 'Recall': 0.8781, 'Threshold': 0.7391}
avg_cval: {'F1': 0.7575, 'Precision': 0.6972, 'Recall': 0.8349, 'Threshold': 0.7743}
avg_ctest: {'F1': 0.7453, 'Precision': 0.6911, 'Recall': 0.8133, 'Threshold': 0.7743}
avg_cval: {'F1': 0.7546, 'Precision': 0.6903, 'Recall': 0.8395, 'Threshold': 0.7681}
avg_ctest: {'F1': 0.7423, 'Precision': 0.6776, 'Recall': 0.8272, 'Threshold': 0.7681}
avg_cval: {'F1': 0.7508, 'Precision': 0.6796, 'Recall': 0.8395, 'Threshold': 0.766}
avg_ctest: {'F1': 0.7545, 'Precision': 0.6824, 'Recall': 0.8448, 'Threshold': 0.766}
avg_cval: {'F1': 0.7562, 'Precision': 0.6704, 'Recall': 0.8673, 'Threshold': 0.7559}
avg_ctest: {'F1': 0.7488, 'Precision': 0.6696, 'Recall': 0.8503, 'Threshold': 0.7559}
avg_cval: {'F1': 0.7544, 'Precision': 0.6977, 'Recall': 0.8241, 'Threshold': 0.7802}
avg_ctest: {'F1': 0.7371, 'Precision': 0.6848, 'Recall': 0.8002, 'Threshold': 0.7802}
avg_cval: {'F1': 0.7627, 'Precision': 0.6656, 'Recall': 0.8935, 'Threshold': 0.7377}
avg_ctest: {'F1': 0.7477, 'Precision': 0.6585, 'Recall': 0.8657, 'Threshold': 0.7377}
avg_cval: {'F1': 0.7528, 'Precision': 0.6832, 'Recall': 0.8403, 'Threshold': 0.7695}
avg_ctest: {'F1': 0.7427, 'Precision': 0.676, 'Recall': 0.8248, 'Threshold': 0.7695}
avg_cval: {'F1': 0.7557, 'Precision': 0.6723, 'Recall': 0.8642, 'Threshold': 0.7447}
avg_ctest: {'F1': 0.7535, 'Precision': 0.6671, 'Recall': 0.8681, 'Threshold': 0.7447}
avg_cval: {'F1': 0.7566, 'Precision': 0.6663, 'Recall': 0.8758, 'Threshold': 0.7445}
avg_ctest: {'F1': 0.754, 'Precision': 0.6641, 'Recall': 0.8727, 'Threshold': 0.7445}
> Simulation Completed
/home/waris/.conda/envs/llm/lib/python3.11/site-packages/numpy/core/fromnumeric.py:59: FutureWarning: 'DataFrame.swapaxes' is deprecated and will be removed in a future version. Please use 'DataFrame.transpose' instead.
  return bound(*args, **kwds)
WARNING flwr 2024-01-09 18:48:28,959 | fedavg.py:117 | 
Setting `min_available_clients` lower than `min_fit_clients` or
`min_evaluate_clients` can cause the server to fail when there are too few clients
connected to the server. `min_available_clients` must be set to a value larger
than or equal to the values of `min_fit_clients` and `min_evaluate_clients`.

INFO flwr 2024-01-09 18:48:28,961 | app.py:178 | Starting Flower simulation, config: ServerConfig(num_rounds=30, round_timeout=None)
2024-01-09 18:48:32,490	INFO worker.py:1724 -- Started a local Ray instance.
INFO flwr 2024-01-09 18:48:33,859 | app.py:213 | Flower VCE: Ray initialized with resources: {'node:__internal_head__': 1.0, 'memory': 1150370544640.0, 'GPU': 4.0, 'CPU': 32.0, 'node:10.128.9.202': 1.0, 'object_store_memory': 200000000000.0, 'accelerator_type:A100': 1.0}
INFO flwr 2024-01-09 18:48:33,860 | app.py:219 | Optimize your simulation with Flower VCE: https://flower.dev/docs/framework/how-to-run-simulations.html
INFO flwr 2024-01-09 18:48:33,860 | app.py:242 | Flower VCE: Resources for each Virtual Client: {'num_cpus': 3, 'num_gpus': 1}
INFO flwr 2024-01-09 18:48:33,870 | app.py:288 | Flower VCE: Creating VirtualClientEngineActorPool with 4 actors
INFO flwr 2024-01-09 18:48:33,870 | server.py:89 | Initializing global parameters
INFO flwr 2024-01-09 18:48:33,870 | server.py:276 | Requesting initial parameters from one random client
INFO flwr 2024-01-09 18:48:42,446 | server.py:280 | Received initial parameters from one random client
INFO flwr 2024-01-09 18:48:42,447 | server.py:91 | Evaluating initial parameters
INFO flwr 2024-01-09 18:49:03,511 | server.py:94 | initial parameters (loss, other metrics): None, {'val_f1': 0.745, 'test_f1': 0.743, 'val_precision': 0.639, 'test_precision': 0.636, 'val_recall': 0.895, 'test_recall': 0.894, 'val_accuracy': 0.768, 'test_accuracy': 0.751}
INFO flwr 2024-01-09 18:49:03,512 | server.py:104 | FL starting
DEBUG flwr 2024-01-09 18:49:03,512 | server.py:222 | fit_round 1: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:50:29,777 | server.py:236 | fit_round 1 received 4 results and 0 failures
INFO flwr 2024-01-09 18:50:48,837 | server.py:125 | fit progress: (1, None, {'val_f1': 0.773, 'test_f1': 0.768, 'val_precision': 0.696, 'test_precision': 0.691, 'val_recall': 0.868, 'test_recall': 0.864, 'val_accuracy': 0.799, 'test_accuracy': 0.789}, 105.32532387319952)
INFO flwr 2024-01-09 18:50:48,838 | server.py:171 | evaluate_round 1: no clients selected, cancel
DEBUG flwr 2024-01-09 18:50:48,839 | server.py:222 | fit_round 2: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:52:07,628 | server.py:236 | fit_round 2 received 4 results and 0 failures
INFO flwr 2024-01-09 18:52:26,646 | server.py:125 | fit progress: (2, None, {'val_f1': 0.781, 'test_f1': 0.774, 'val_precision': 0.708, 'test_precision': 0.701, 'val_recall': 0.871, 'test_recall': 0.864, 'val_accuracy': 0.808, 'test_accuracy': 0.797}, 203.13346375059336)
INFO flwr 2024-01-09 18:52:26,646 | server.py:171 | evaluate_round 2: no clients selected, cancel
DEBUG flwr 2024-01-09 18:52:26,647 | server.py:222 | fit_round 3: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:53:48,778 | server.py:236 | fit_round 3 received 4 results and 0 failures
INFO flwr 2024-01-09 18:54:06,569 | server.py:125 | fit progress: (3, None, {'val_f1': 0.786, 'test_f1': 0.78, 'val_precision': 0.721, 'test_precision': 0.715, 'val_recall': 0.863, 'test_recall': 0.859, 'val_accuracy': 0.813, 'test_accuracy': 0.804}, 303.056733449921)
INFO flwr 2024-01-09 18:54:06,570 | server.py:171 | evaluate_round 3: no clients selected, cancel
DEBUG flwr 2024-01-09 18:54:06,570 | server.py:222 | fit_round 4: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:55:36,582 | server.py:236 | fit_round 4 received 4 results and 0 failures
INFO flwr 2024-01-09 18:55:55,553 | server.py:125 | fit progress: (4, None, {'val_f1': 0.787, 'test_f1': 0.783, 'val_precision': 0.715, 'test_precision': 0.71, 'val_recall': 0.874, 'test_recall': 0.872, 'val_accuracy': 0.814, 'test_accuracy': 0.804}, 412.04097595158964)
INFO flwr 2024-01-09 18:55:55,554 | server.py:171 | evaluate_round 4: no clients selected, cancel
DEBUG flwr 2024-01-09 18:55:55,554 | server.py:222 | fit_round 5: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:57:18,730 | server.py:236 | fit_round 5 received 4 results and 0 failures
INFO flwr 2024-01-09 18:57:37,802 | server.py:125 | fit progress: (5, None, {'val_f1': 0.789, 'test_f1': 0.785, 'val_precision': 0.707, 'test_precision': 0.703, 'val_recall': 0.892, 'test_recall': 0.891, 'val_accuracy': 0.817, 'test_accuracy': 0.804}, 514.2899201735854)
INFO flwr 2024-01-09 18:57:37,803 | server.py:171 | evaluate_round 5: no clients selected, cancel
DEBUG flwr 2024-01-09 18:57:37,803 | server.py:222 | fit_round 6: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 18:59:04,192 | server.py:236 | fit_round 6 received 4 results and 0 failures
INFO flwr 2024-01-09 18:59:23,141 | server.py:125 | fit progress: (6, None, {'val_f1': 0.791, 'test_f1': 0.787, 'val_precision': 0.711, 'test_precision': 0.706, 'val_recall': 0.89, 'test_recall': 0.89, 'val_accuracy': 0.819, 'test_accuracy': 0.806}, 619.6286304481328)
INFO flwr 2024-01-09 18:59:23,142 | server.py:171 | evaluate_round 6: no clients selected, cancel
DEBUG flwr 2024-01-09 18:59:23,142 | server.py:222 | fit_round 7: strategy sampled 4 clients (out of 20)
ERROR flwr 2024-01-09 19:00:47,712 | ray_client_proxy.py:145 | Traceback (most recent call last):
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 138, in _submit_job
    res = self.actor_pool.get_client_result(self.cid, timeout)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 414, in get_client_result
    return self._fetch_future_result(cid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 300, in _fetch_future_result
    res_cid, res = ray.get(future)  # type: (str, ClientRes)
                   ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/auto_init_hook.py", line 22, in auto_init_wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/worker.py", line 2624, in get
    raise value.as_instanceof_cause()
ray.exceptions.RayTaskError(ClientException): [36mray::DefaultActor.run()[39m (pid=52128, ip=10.128.9.202, actor_id=e4e5ea4775f394878691b77301000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2ada07ee1590>)
                  ^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit
    return maybe_call_fit(
           ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit
    return client.fit(fit_ins)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit
    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit
    self.net, val_results, test_results = _trainTransformer(
                                          ^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer
    model.fit(
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit
    loss_value = loss_model(features, labels)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
            ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward
    output_states = self.auto_model(**trans_features, return_dict=False)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 1013, in forward
    encoder_outputs = self.encoder(
                      ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 607, in forward
    layer_outputs = layer_module(
                    ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 539, in forward
    layer_output = apply_chunking_to_forward(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/pytorch_utils.py", line 242, in apply_chunking_to_forward
    return forward_fn(*input_tensors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 552, in feed_forward_chunk
    layer_output = self.output(intermediate_output, attention_output)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 466, in forward
    hidden_states = self.LayerNorm(hidden_states + input_tensor)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/normalization.py", line 196, in forward
    return F.layer_norm(
           ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/functional.py", line 2543, in layer_norm
    return torch.layer_norm(input, normalized_shape, weight, bias, eps, torch.backends.cudnn.enabled)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 174.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 30.12 MiB is free. Including non-PyTorch memory, this process has 79.31 GiB memory in use. Of the allocated memory 73.28 GiB is allocated by PyTorch, and 4.76 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

The above exception was the direct cause of the following exception:

[36mray::DefaultActor.run()[39m (pid=52128, ip=10.128.9.202, actor_id=e4e5ea4775f394878691b77301000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2ada07ee1590>)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 84, in run
    raise ClientException(str(message)) from ex
flwr.simulation.ray_transport.ray_actor.ClientException: 
>>>>>>>A ClientException occurred.('\n\tSomething went wrong when running your client workload.\n\tClient 11 crashed when the DefaultActor was running its workload.\n\tException triggered on the client side: Traceback (most recent call last):\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 72, in run\n    job_results = job_fn(client)\n                  ^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit\n    return maybe_call_fit(\n           ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit\n    return client.fit(fit_ins)\n           ^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit\n    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit\n    self.net, val_results, test_results = _trainTransformer(\n                                          ^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer\n    model.fit(\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit\n    loss_value = loss_model(features, labels)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward\n    input = module(input)\n            ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward\n    output_states = self.auto_model(**trans_features, return_dict=False)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 1013, in forward\n    encoder_outputs = self.encoder(\n                      ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 607, in forward\n    layer_outputs = layer_module(\n                    ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 539, in forward\n    layer_output = apply_chunking_to_forward(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/pytorch_utils.py", line 242, in apply_chunking_to_forward\n    return forward_fn(*input_tensors)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 552, in feed_forward_chunk\n    layer_output = self.output(intermediate_output, attention_output)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 466, in forward\n    hidden_states = self.LayerNorm(hidden_states + input_tensor)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/normalization.py", line 196, in forward\n    return F.layer_norm(\n           ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/functional.py", line 2543, in layer_norm\n    return torch.layer_norm(input, normalized_shape, weight, bias, eps, torch.backends.cudnn.enabled)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ntorch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 174.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 30.12 MiB is free. Including non-PyTorch memory, this process has 79.31 GiB memory in use. Of the allocated memory 73.28 GiB is allocated by PyTorch, and 4.76 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\n',)

ERROR flwr 2024-01-09 19:00:47,713 | ray_client_proxy.py:146 | [36mray::DefaultActor.run()[39m (pid=52128, ip=10.128.9.202, actor_id=e4e5ea4775f394878691b77301000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2ada07ee1590>)
                  ^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit
    return maybe_call_fit(
           ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit
    return client.fit(fit_ins)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit
    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit
    self.net, val_results, test_results = _trainTransformer(
                                          ^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer
    model.fit(
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit
    loss_value = loss_model(features, labels)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
            ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward
    output_states = self.auto_model(**trans_features, return_dict=False)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 1013, in forward
    encoder_outputs = self.encoder(
                      ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 607, in forward
    layer_outputs = layer_module(
                    ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 539, in forward
    layer_output = apply_chunking_to_forward(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/pytorch_utils.py", line 242, in apply_chunking_to_forward
    return forward_fn(*input_tensors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 552, in feed_forward_chunk
    layer_output = self.output(intermediate_output, attention_output)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 466, in forward
    hidden_states = self.LayerNorm(hidden_states + input_tensor)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/normalization.py", line 196, in forward
    return F.layer_norm(
           ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/functional.py", line 2543, in layer_norm
    return torch.layer_norm(input, normalized_shape, weight, bias, eps, torch.backends.cudnn.enabled)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 174.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 30.12 MiB is free. Including non-PyTorch memory, this process has 79.31 GiB memory in use. Of the allocated memory 73.28 GiB is allocated by PyTorch, and 4.76 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

The above exception was the direct cause of the following exception:

[36mray::DefaultActor.run()[39m (pid=52128, ip=10.128.9.202, actor_id=e4e5ea4775f394878691b77301000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2ada07ee1590>)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 84, in run
    raise ClientException(str(message)) from ex
flwr.simulation.ray_transport.ray_actor.ClientException: 
>>>>>>>A ClientException occurred.('\n\tSomething went wrong when running your client workload.\n\tClient 11 crashed when the DefaultActor was running its workload.\n\tException triggered on the client side: Traceback (most recent call last):\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 72, in run\n    job_results = job_fn(client)\n                  ^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit\n    return maybe_call_fit(\n           ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit\n    return client.fit(fit_ins)\n           ^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit\n    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit\n    self.net, val_results, test_results = _trainTransformer(\n                                          ^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer\n    model.fit(\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit\n    loss_value = loss_model(features, labels)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward\n    input = module(input)\n            ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward\n    output_states = self.auto_model(**trans_features, return_dict=False)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 1013, in forward\n    encoder_outputs = self.encoder(\n                      ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 607, in forward\n    layer_outputs = layer_module(\n                    ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 539, in forward\n    layer_output = apply_chunking_to_forward(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/pytorch_utils.py", line 242, in apply_chunking_to_forward\n    return forward_fn(*input_tensors)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 552, in feed_forward_chunk\n    layer_output = self.output(intermediate_output, attention_output)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 466, in forward\n    hidden_states = self.LayerNorm(hidden_states + input_tensor)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/normalization.py", line 196, in forward\n    return F.layer_norm(\n           ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/functional.py", line 2543, in layer_norm\n    return torch.layer_norm(input, normalized_shape, weight, bias, eps, torch.backends.cudnn.enabled)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ntorch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 174.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 30.12 MiB is free. Including non-PyTorch memory, this process has 79.31 GiB memory in use. Of the allocated memory 73.28 GiB is allocated by PyTorch, and 4.76 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\n',)
DEBUG flwr 2024-01-09 19:00:47,713 | server.py:236 | fit_round 7 received 3 results and 1 failures
INFO flwr 2024-01-09 19:01:06,244 | server.py:125 | fit progress: (7, None, {'val_f1': 0.791, 'test_f1': 0.787, 'val_precision': 0.72, 'test_precision': 0.715, 'val_recall': 0.877, 'test_recall': 0.876, 'val_accuracy': 0.819, 'test_accuracy': 0.809}, 722.7317248424515)
INFO flwr 2024-01-09 19:01:06,245 | server.py:171 | evaluate_round 7: no clients selected, cancel
DEBUG flwr 2024-01-09 19:01:06,245 | server.py:222 | fit_round 8: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:02:27,370 | server.py:236 | fit_round 8 received 4 results and 0 failures
INFO flwr 2024-01-09 19:02:44,927 | server.py:125 | fit progress: (8, None, {'val_f1': 0.794, 'test_f1': 0.791, 'val_precision': 0.722, 'test_precision': 0.717, 'val_recall': 0.882, 'test_recall': 0.881, 'val_accuracy': 0.821, 'test_accuracy': 0.811}, 821.4146633865312)
INFO flwr 2024-01-09 19:02:44,927 | server.py:171 | evaluate_round 8: no clients selected, cancel
DEBUG flwr 2024-01-09 19:02:44,927 | server.py:222 | fit_round 9: strategy sampled 4 clients (out of 20)
ERROR flwr 2024-01-09 19:04:00,759 | ray_client_proxy.py:145 | Traceback (most recent call last):
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 138, in _submit_job
    res = self.actor_pool.get_client_result(self.cid, timeout)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 414, in get_client_result
    return self._fetch_future_result(cid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 300, in _fetch_future_result
    res_cid, res = ray.get(future)  # type: (str, ClientRes)
                   ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/auto_init_hook.py", line 22, in auto_init_wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/worker.py", line 2624, in get
    raise value.as_instanceof_cause()
ray.exceptions.RayTaskError(ClientException): [36mray::DefaultActor.run()[39m (pid=52126, ip=10.128.9.202, actor_id=0f6b579f9fc16a9913db8c6301000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2aab2b289590>)
                  ^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit
    return maybe_call_fit(
           ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit
    return client.fit(fit_ins)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit
    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit
    self.net, val_results, test_results = _trainTransformer(
                                          ^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer
    model.fit(
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit
    loss_value = loss_model(features, labels)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
            ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward
    output_states = self.auto_model(**trans_features, return_dict=False)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 1013, in forward
    encoder_outputs = self.encoder(
                      ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 607, in forward
    layer_outputs = layer_module(
                    ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 497, in forward
    self_attention_outputs = self.attention(
                             ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 427, in forward
    self_outputs = self.self(
                   ^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 359, in forward
    attention_probs = self.dropout(attention_probs)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/dropout.py", line 58, in forward
    return F.dropout(input, self.p, self.training, self.inplace)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/functional.py", line 1266, in dropout
    return _VF.dropout_(input, p, training) if inplace else _VF.dropout(input, p, training)
                                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.51 GiB. GPU 0 has a total capacty of 79.35 GiB of which 232.12 MiB is free. Including non-PyTorch memory, this process has 79.12 GiB memory in use. Of the allocated memory 73.34 GiB is allocated by PyTorch, and 4.50 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

The above exception was the direct cause of the following exception:

[36mray::DefaultActor.run()[39m (pid=52126, ip=10.128.9.202, actor_id=0f6b579f9fc16a9913db8c6301000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2aab2b289590>)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 84, in run
    raise ClientException(str(message)) from ex
flwr.simulation.ray_transport.ray_actor.ClientException: 
>>>>>>>A ClientException occurred.('\n\tSomething went wrong when running your client workload.\n\tClient 11 crashed when the DefaultActor was running its workload.\n\tException triggered on the client side: Traceback (most recent call last):\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 72, in run\n    job_results = job_fn(client)\n                  ^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit\n    return maybe_call_fit(\n           ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit\n    return client.fit(fit_ins)\n           ^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit\n    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit\n    self.net, val_results, test_results = _trainTransformer(\n                                          ^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer\n    model.fit(\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit\n    loss_value = loss_model(features, labels)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward\n    input = module(input)\n            ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward\n    output_states = self.auto_model(**trans_features, return_dict=False)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 1013, in forward\n    encoder_outputs = self.encoder(\n                      ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 607, in forward\n    layer_outputs = layer_module(\n                    ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 497, in forward\n    self_attention_outputs = self.attention(\n                             ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 427, in forward\n    self_outputs = self.self(\n                   ^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 359, in forward\n    attention_probs = self.dropout(attention_probs)\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/dropout.py", line 58, in forward\n    return F.dropout(input, self.p, self.training, self.inplace)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/functional.py", line 1266, in dropout\n    return _VF.dropout_(input, p, training) if inplace else _VF.dropout(input, p, training)\n                                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ntorch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.51 GiB. GPU 0 has a total capacty of 79.35 GiB of which 232.12 MiB is free. Including non-PyTorch memory, this process has 79.12 GiB memory in use. Of the allocated memory 73.34 GiB is allocated by PyTorch, and 4.50 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\n',)

ERROR flwr 2024-01-09 19:04:00,759 | ray_client_proxy.py:146 | [36mray::DefaultActor.run()[39m (pid=52126, ip=10.128.9.202, actor_id=0f6b579f9fc16a9913db8c6301000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2aab2b289590>)
                  ^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit
    return maybe_call_fit(
           ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit
    return client.fit(fit_ins)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit
    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit
    self.net, val_results, test_results = _trainTransformer(
                                          ^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer
    model.fit(
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit
    loss_value = loss_model(features, labels)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
            ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward
    output_states = self.auto_model(**trans_features, return_dict=False)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 1013, in forward
    encoder_outputs = self.encoder(
                      ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 607, in forward
    layer_outputs = layer_module(
                    ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 497, in forward
    self_attention_outputs = self.attention(
                             ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 427, in forward
    self_outputs = self.self(
                   ^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 359, in forward
    attention_probs = self.dropout(attention_probs)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/dropout.py", line 58, in forward
    return F.dropout(input, self.p, self.training, self.inplace)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/functional.py", line 1266, in dropout
    return _VF.dropout_(input, p, training) if inplace else _VF.dropout(input, p, training)
                                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.51 GiB. GPU 0 has a total capacty of 79.35 GiB of which 232.12 MiB is free. Including non-PyTorch memory, this process has 79.12 GiB memory in use. Of the allocated memory 73.34 GiB is allocated by PyTorch, and 4.50 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

The above exception was the direct cause of the following exception:

[36mray::DefaultActor.run()[39m (pid=52126, ip=10.128.9.202, actor_id=0f6b579f9fc16a9913db8c6301000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2aab2b289590>)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 84, in run
    raise ClientException(str(message)) from ex
flwr.simulation.ray_transport.ray_actor.ClientException: 
>>>>>>>A ClientException occurred.('\n\tSomething went wrong when running your client workload.\n\tClient 11 crashed when the DefaultActor was running its workload.\n\tException triggered on the client side: Traceback (most recent call last):\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 72, in run\n    job_results = job_fn(client)\n                  ^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit\n    return maybe_call_fit(\n           ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit\n    return client.fit(fit_ins)\n           ^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit\n    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit\n    self.net, val_results, test_results = _trainTransformer(\n                                          ^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer\n    model.fit(\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit\n    loss_value = loss_model(features, labels)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward\n    input = module(input)\n            ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward\n    output_states = self.auto_model(**trans_features, return_dict=False)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 1013, in forward\n    encoder_outputs = self.encoder(\n                      ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 607, in forward\n    layer_outputs = layer_module(\n                    ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 497, in forward\n    self_attention_outputs = self.attention(\n                             ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 427, in forward\n    self_outputs = self.self(\n                   ^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/bert/modeling_bert.py", line 359, in forward\n    attention_probs = self.dropout(attention_probs)\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/dropout.py", line 58, in forward\n    return F.dropout(input, self.p, self.training, self.inplace)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/functional.py", line 1266, in dropout\n    return _VF.dropout_(input, p, training) if inplace else _VF.dropout(input, p, training)\n                                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ntorch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.51 GiB. GPU 0 has a total capacty of 79.35 GiB of which 232.12 MiB is free. Including non-PyTorch memory, this process has 79.12 GiB memory in use. Of the allocated memory 73.34 GiB is allocated by PyTorch, and 4.50 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\n',)
DEBUG flwr 2024-01-09 19:04:09,164 | server.py:236 | fit_round 9 received 3 results and 1 failures
INFO flwr 2024-01-09 19:04:26,660 | server.py:125 | fit progress: (9, None, {'val_f1': 0.795, 'test_f1': 0.791, 'val_precision': 0.723, 'test_precision': 0.717, 'val_recall': 0.883, 'test_recall': 0.881, 'val_accuracy': 0.823, 'test_accuracy': 0.812}, 923.1480815839022)
INFO flwr 2024-01-09 19:04:26,661 | server.py:171 | evaluate_round 9: no clients selected, cancel
DEBUG flwr 2024-01-09 19:04:26,661 | server.py:222 | fit_round 10: strategy sampled 4 clients (out of 20)
ERROR flwr 2024-01-09 19:04:57,306 | ray_client_proxy.py:145 | Traceback (most recent call last):
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 138, in _submit_job
    res = self.actor_pool.get_client_result(self.cid, timeout)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 414, in get_client_result
    return self._fetch_future_result(cid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 300, in _fetch_future_result
    res_cid, res = ray.get(future)  # type: (str, ClientRes)
                   ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/auto_init_hook.py", line 22, in auto_init_wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/worker.py", line 2624, in get
    raise value.as_instanceof_cause()
ray.exceptions.RayTaskError(ClientException): [36mray::DefaultActor.run()[39m (pid=52128, ip=10.128.9.202, actor_id=e4e5ea4775f394878691b77301000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2ada07ee1590>)
                  ^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit
    return maybe_call_fit(
           ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit
    return client.fit(fit_ins)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit
    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit
    self.net, val_results, test_results = _trainTransformer(
                                          ^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer
    model.fit(
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit
    loss_value = loss_model(features, labels)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
            ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Pooling.py", line 86, in forward
    sum_embeddings = torch.sum(token_embeddings * input_mask_expanded, 1)
                               ~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 174.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 28.12 MiB is free. Including non-PyTorch memory, this process has 79.32 GiB memory in use. Of the allocated memory 73.45 GiB is allocated by PyTorch, and 4.59 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

The above exception was the direct cause of the following exception:

[36mray::DefaultActor.run()[39m (pid=52128, ip=10.128.9.202, actor_id=e4e5ea4775f394878691b77301000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2ada07ee1590>)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 84, in run
    raise ClientException(str(message)) from ex
flwr.simulation.ray_transport.ray_actor.ClientException: 
>>>>>>>A ClientException occurred.('\n\tSomething went wrong when running your client workload.\n\tClient 11 crashed when the DefaultActor was running its workload.\n\tException triggered on the client side: Traceback (most recent call last):\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 72, in run\n    job_results = job_fn(client)\n                  ^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit\n    return maybe_call_fit(\n           ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit\n    return client.fit(fit_ins)\n           ^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit\n    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit\n    self.net, val_results, test_results = _trainTransformer(\n                                          ^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer\n    model.fit(\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit\n    loss_value = loss_model(features, labels)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward\n    input = module(input)\n            ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Pooling.py", line 86, in forward\n    sum_embeddings = torch.sum(token_embeddings * input_mask_expanded, 1)\n                               ~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~\ntorch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 174.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 28.12 MiB is free. Including non-PyTorch memory, this process has 79.32 GiB memory in use. Of the allocated memory 73.45 GiB is allocated by PyTorch, and 4.59 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\n',)

ERROR flwr 2024-01-09 19:04:57,307 | ray_client_proxy.py:146 | [36mray::DefaultActor.run()[39m (pid=52128, ip=10.128.9.202, actor_id=e4e5ea4775f394878691b77301000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2ada07ee1590>)
                  ^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit
    return maybe_call_fit(
           ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit
    return client.fit(fit_ins)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit
    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit
    self.net, val_results, test_results = _trainTransformer(
                                          ^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer
    model.fit(
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit
    loss_value = loss_model(features, labels)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
            ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Pooling.py", line 86, in forward
    sum_embeddings = torch.sum(token_embeddings * input_mask_expanded, 1)
                               ~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 174.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 28.12 MiB is free. Including non-PyTorch memory, this process has 79.32 GiB memory in use. Of the allocated memory 73.45 GiB is allocated by PyTorch, and 4.59 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

The above exception was the direct cause of the following exception:

[36mray::DefaultActor.run()[39m (pid=52128, ip=10.128.9.202, actor_id=e4e5ea4775f394878691b77301000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2ada07ee1590>)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 84, in run
    raise ClientException(str(message)) from ex
flwr.simulation.ray_transport.ray_actor.ClientException: 
>>>>>>>A ClientException occurred.('\n\tSomething went wrong when running your client workload.\n\tClient 11 crashed when the DefaultActor was running its workload.\n\tException triggered on the client side: Traceback (most recent call last):\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 72, in run\n    job_results = job_fn(client)\n                  ^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit\n    return maybe_call_fit(\n           ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit\n    return client.fit(fit_ins)\n           ^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit\n    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit\n    self.net, val_results, test_results = _trainTransformer(\n                                          ^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer\n    model.fit(\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit\n    loss_value = loss_model(features, labels)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward\n    input = module(input)\n            ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Pooling.py", line 86, in forward\n    sum_embeddings = torch.sum(token_embeddings * input_mask_expanded, 1)\n                               ~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~\ntorch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 174.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 28.12 MiB is free. Including non-PyTorch memory, this process has 79.32 GiB memory in use. Of the allocated memory 73.45 GiB is allocated by PyTorch, and 4.59 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\n',)
DEBUG flwr 2024-01-09 19:05:45,566 | server.py:236 | fit_round 10 received 3 results and 1 failures
INFO flwr 2024-01-09 19:06:04,516 | server.py:125 | fit progress: (10, None, {'val_f1': 0.796, 'test_f1': 0.793, 'val_precision': 0.725, 'test_precision': 0.72, 'val_recall': 0.883, 'test_recall': 0.881, 'val_accuracy': 0.824, 'test_accuracy': 0.814}, 1021.0034060450271)
INFO flwr 2024-01-09 19:06:04,516 | server.py:171 | evaluate_round 10: no clients selected, cancel
DEBUG flwr 2024-01-09 19:06:04,516 | server.py:222 | fit_round 11: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:07:32,919 | server.py:236 | fit_round 11 received 4 results and 0 failures
INFO flwr 2024-01-09 19:07:51,862 | server.py:125 | fit progress: (11, None, {'val_f1': 0.797, 'test_f1': 0.793, 'val_precision': 0.722, 'test_precision': 0.717, 'val_recall': 0.89, 'test_recall': 0.887, 'val_accuracy': 0.825, 'test_accuracy': 0.813}, 1128.3498563235626)
INFO flwr 2024-01-09 19:07:51,866 | server.py:171 | evaluate_round 11: no clients selected, cancel
DEBUG flwr 2024-01-09 19:07:51,866 | server.py:222 | fit_round 12: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:09:13,868 | server.py:236 | fit_round 12 received 4 results and 0 failures
INFO flwr 2024-01-09 19:09:32,936 | server.py:125 | fit progress: (12, None, {'val_f1': 0.799, 'test_f1': 0.795, 'val_precision': 0.727, 'test_precision': 0.723, 'val_recall': 0.885, 'test_recall': 0.884, 'val_accuracy': 0.826, 'test_accuracy': 0.816}, 1229.4242947744206)
INFO flwr 2024-01-09 19:09:32,937 | server.py:171 | evaluate_round 12: no clients selected, cancel
DEBUG flwr 2024-01-09 19:09:32,937 | server.py:222 | fit_round 13: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:10:56,838 | server.py:236 | fit_round 13 received 4 results and 0 failures
INFO flwr 2024-01-09 19:11:15,781 | server.py:125 | fit progress: (13, None, {'val_f1': 0.8, 'test_f1': 0.796, 'val_precision': 0.725, 'test_precision': 0.72, 'val_recall': 0.892, 'test_recall': 0.889, 'val_accuracy': 0.828, 'test_accuracy': 0.816}, 1332.2684710742906)
INFO flwr 2024-01-09 19:11:15,782 | server.py:171 | evaluate_round 13: no clients selected, cancel
DEBUG flwr 2024-01-09 19:11:15,782 | server.py:222 | fit_round 14: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:12:33,282 | server.py:236 | fit_round 14 received 4 results and 0 failures
INFO flwr 2024-01-09 19:12:52,181 | server.py:125 | fit progress: (14, None, {'val_f1': 0.801, 'test_f1': 0.797, 'val_precision': 0.733, 'test_precision': 0.729, 'val_recall': 0.882, 'test_recall': 0.88, 'val_accuracy': 0.828, 'test_accuracy': 0.819}, 1428.6687507554889)
INFO flwr 2024-01-09 19:12:52,185 | server.py:171 | evaluate_round 14: no clients selected, cancel
DEBUG flwr 2024-01-09 19:12:52,185 | server.py:222 | fit_round 15: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:14:13,360 | server.py:236 | fit_round 15 received 4 results and 0 failures
INFO flwr 2024-01-09 19:14:32,433 | server.py:125 | fit progress: (15, None, {'val_f1': 0.801, 'test_f1': 0.797, 'val_precision': 0.735, 'test_precision': 0.73, 'val_recall': 0.879, 'test_recall': 0.876, 'val_accuracy': 0.828, 'test_accuracy': 0.819}, 1528.9209069814533)
INFO flwr 2024-01-09 19:14:32,434 | server.py:171 | evaluate_round 15: no clients selected, cancel
DEBUG flwr 2024-01-09 19:14:32,434 | server.py:222 | fit_round 16: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:15:57,795 | server.py:236 | fit_round 16 received 4 results and 0 failures
INFO flwr 2024-01-09 19:16:15,357 | server.py:125 | fit progress: (16, None, {'val_f1': 0.802, 'test_f1': 0.797, 'val_precision': 0.732, 'test_precision': 0.726, 'val_recall': 0.885, 'test_recall': 0.883, 'val_accuracy': 0.829, 'test_accuracy': 0.818}, 1631.8449633186683)
INFO flwr 2024-01-09 19:16:15,361 | server.py:171 | evaluate_round 16: no clients selected, cancel
DEBUG flwr 2024-01-09 19:16:15,361 | server.py:222 | fit_round 17: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:17:35,809 | server.py:236 | fit_round 17 received 4 results and 0 failures
INFO flwr 2024-01-09 19:17:53,393 | server.py:125 | fit progress: (17, None, {'val_f1': 0.802, 'test_f1': 0.798, 'val_precision': 0.739, 'test_precision': 0.734, 'val_recall': 0.876, 'test_recall': 0.873, 'val_accuracy': 0.83, 'test_accuracy': 0.821}, 1729.880953496322)
INFO flwr 2024-01-09 19:17:53,394 | server.py:171 | evaluate_round 17: no clients selected, cancel
DEBUG flwr 2024-01-09 19:17:53,394 | server.py:222 | fit_round 18: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:19:20,663 | server.py:236 | fit_round 18 received 4 results and 0 failures
INFO flwr 2024-01-09 19:19:38,175 | server.py:125 | fit progress: (18, None, {'val_f1': 0.803, 'test_f1': 0.799, 'val_precision': 0.735, 'test_precision': 0.729, 'val_recall': 0.886, 'test_recall': 0.883, 'val_accuracy': 0.831, 'test_accuracy': 0.821}, 1834.6630825344473)
INFO flwr 2024-01-09 19:19:38,176 | server.py:171 | evaluate_round 18: no clients selected, cancel
DEBUG flwr 2024-01-09 19:19:38,176 | server.py:222 | fit_round 19: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:21:02,525 | server.py:236 | fit_round 19 received 4 results and 0 failures
INFO flwr 2024-01-09 19:21:20,175 | server.py:125 | fit progress: (19, None, {'val_f1': 0.805, 'test_f1': 0.8, 'val_precision': 0.739, 'test_precision': 0.734, 'val_recall': 0.883, 'test_recall': 0.88, 'val_accuracy': 0.831, 'test_accuracy': 0.823}, 1936.662524570711)
INFO flwr 2024-01-09 19:21:20,175 | server.py:171 | evaluate_round 19: no clients selected, cancel
DEBUG flwr 2024-01-09 19:21:20,175 | server.py:222 | fit_round 20: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:22:43,787 | server.py:236 | fit_round 20 received 4 results and 0 failures
INFO flwr 2024-01-09 19:23:02,105 | server.py:125 | fit progress: (20, None, {'val_f1': 0.805, 'test_f1': 0.801, 'val_precision': 0.741, 'test_precision': 0.736, 'val_recall': 0.882, 'test_recall': 0.878, 'val_accuracy': 0.833, 'test_accuracy': 0.824}, 2038.5925479009748)
INFO flwr 2024-01-09 19:23:02,106 | server.py:171 | evaluate_round 20: no clients selected, cancel
DEBUG flwr 2024-01-09 19:23:02,106 | server.py:222 | fit_round 21: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:24:22,568 | server.py:236 | fit_round 21 received 4 results and 0 failures
INFO flwr 2024-01-09 19:24:41,459 | server.py:125 | fit progress: (21, None, {'val_f1': 0.805, 'test_f1': 0.802, 'val_precision': 0.745, 'test_precision': 0.741, 'val_recall': 0.876, 'test_recall': 0.874, 'val_accuracy': 0.833, 'test_accuracy': 0.826}, 2137.9469224680215)
INFO flwr 2024-01-09 19:24:41,459 | server.py:171 | evaluate_round 21: no clients selected, cancel
DEBUG flwr 2024-01-09 19:24:41,459 | server.py:222 | fit_round 22: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:26:01,582 | server.py:236 | fit_round 22 received 4 results and 0 failures
INFO flwr 2024-01-09 19:26:20,442 | server.py:125 | fit progress: (22, None, {'val_f1': 0.806, 'test_f1': 0.802, 'val_precision': 0.743, 'test_precision': 0.739, 'val_recall': 0.88, 'test_recall': 0.877, 'val_accuracy': 0.834, 'test_accuracy': 0.826}, 2236.929461470805)
INFO flwr 2024-01-09 19:26:20,442 | server.py:171 | evaluate_round 22: no clients selected, cancel
DEBUG flwr 2024-01-09 19:26:20,442 | server.py:222 | fit_round 23: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:27:41,716 | server.py:236 | fit_round 23 received 4 results and 0 failures
INFO flwr 2024-01-09 19:28:00,653 | server.py:125 | fit progress: (23, None, {'val_f1': 0.806, 'test_f1': 0.802, 'val_precision': 0.746, 'test_precision': 0.742, 'val_recall': 0.876, 'test_recall': 0.873, 'val_accuracy': 0.834, 'test_accuracy': 0.826}, 2337.1406719926745)
INFO flwr 2024-01-09 19:28:00,654 | server.py:171 | evaluate_round 23: no clients selected, cancel
DEBUG flwr 2024-01-09 19:28:00,654 | server.py:222 | fit_round 24: strategy sampled 4 clients (out of 20)
ERROR flwr 2024-01-09 19:28:44,263 | ray_client_proxy.py:145 | Traceback (most recent call last):
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 138, in _submit_job
    res = self.actor_pool.get_client_result(self.cid, timeout)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 414, in get_client_result
    return self._fetch_future_result(cid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 300, in _fetch_future_result
    res_cid, res = ray.get(future)  # type: (str, ClientRes)
                   ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/auto_init_hook.py", line 22, in auto_init_wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/worker.py", line 2624, in get
    raise value.as_instanceof_cause()
ray.exceptions.RayTaskError(ClientException): [36mray::DefaultActor.run()[39m (pid=52127, ip=10.128.9.202, actor_id=3bff7a74d86bd1153b2a060201000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2aab4f289990>)
                  ^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit
    return maybe_call_fit(
           ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit
    return client.fit(fit_ins)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit
    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit
    self.net, val_results, test_results = _trainTransformer(
                                          ^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer
    model.fit(
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 722, in fit
    loss_value.backward()
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/_tensor.py", line 492, in backward
    torch.autograd.backward(
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/autograd/__init__.py", line 251, in backward
    Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 692.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 498.12 MiB is free. Including non-PyTorch memory, this process has 78.86 GiB memory in use. Of the allocated memory 75.41 GiB is allocated by PyTorch, and 2.17 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

The above exception was the direct cause of the following exception:

[36mray::DefaultActor.run()[39m (pid=52127, ip=10.128.9.202, actor_id=3bff7a74d86bd1153b2a060201000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2aab4f289990>)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 84, in run
    raise ClientException(str(message)) from ex
flwr.simulation.ray_transport.ray_actor.ClientException: 
>>>>>>>A ClientException occurred.('\n\tSomething went wrong when running your client workload.\n\tClient 6 crashed when the DefaultActor was running its workload.\n\tException triggered on the client side: Traceback (most recent call last):\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 72, in run\n    job_results = job_fn(client)\n                  ^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit\n    return maybe_call_fit(\n           ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit\n    return client.fit(fit_ins)\n           ^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit\n    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit\n    self.net, val_results, test_results = _trainTransformer(\n                                          ^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer\n    model.fit(\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 722, in fit\n    loss_value.backward()\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/_tensor.py", line 492, in backward\n    torch.autograd.backward(\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/autograd/__init__.py", line 251, in backward\n    Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass\ntorch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 692.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 498.12 MiB is free. Including non-PyTorch memory, this process has 78.86 GiB memory in use. Of the allocated memory 75.41 GiB is allocated by PyTorch, and 2.17 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\n',)

ERROR flwr 2024-01-09 19:28:44,264 | ray_client_proxy.py:146 | [36mray::DefaultActor.run()[39m (pid=52127, ip=10.128.9.202, actor_id=3bff7a74d86bd1153b2a060201000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2aab4f289990>)
                  ^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit
    return maybe_call_fit(
           ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit
    return client.fit(fit_ins)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit
    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit
    self.net, val_results, test_results = _trainTransformer(
                                          ^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer
    model.fit(
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 722, in fit
    loss_value.backward()
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/_tensor.py", line 492, in backward
    torch.autograd.backward(
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/autograd/__init__.py", line 251, in backward
    Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 692.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 498.12 MiB is free. Including non-PyTorch memory, this process has 78.86 GiB memory in use. Of the allocated memory 75.41 GiB is allocated by PyTorch, and 2.17 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

The above exception was the direct cause of the following exception:

[36mray::DefaultActor.run()[39m (pid=52127, ip=10.128.9.202, actor_id=3bff7a74d86bd1153b2a060201000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2aab4f289990>)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 84, in run
    raise ClientException(str(message)) from ex
flwr.simulation.ray_transport.ray_actor.ClientException: 
>>>>>>>A ClientException occurred.('\n\tSomething went wrong when running your client workload.\n\tClient 6 crashed when the DefaultActor was running its workload.\n\tException triggered on the client side: Traceback (most recent call last):\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 72, in run\n    job_results = job_fn(client)\n                  ^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit\n    return maybe_call_fit(\n           ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit\n    return client.fit(fit_ins)\n           ^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit\n    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit\n    self.net, val_results, test_results = _trainTransformer(\n                                          ^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer\n    model.fit(\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 722, in fit\n    loss_value.backward()\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/_tensor.py", line 492, in backward\n    torch.autograd.backward(\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/autograd/__init__.py", line 251, in backward\n    Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass\ntorch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 692.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 498.12 MiB is free. Including non-PyTorch memory, this process has 78.86 GiB memory in use. Of the allocated memory 75.41 GiB is allocated by PyTorch, and 2.17 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\n',)
DEBUG flwr 2024-01-09 19:29:18,306 | server.py:236 | fit_round 24 received 3 results and 1 failures
INFO flwr 2024-01-09 19:29:37,235 | server.py:125 | fit progress: (24, None, {'val_f1': 0.807, 'test_f1': 0.802, 'val_precision': 0.748, 'test_precision': 0.743, 'val_recall': 0.875, 'test_recall': 0.872, 'val_accuracy': 0.834, 'test_accuracy': 0.827}, 2433.723085248843)
INFO flwr 2024-01-09 19:29:37,237 | server.py:171 | evaluate_round 24: no clients selected, cancel
DEBUG flwr 2024-01-09 19:29:37,237 | server.py:222 | fit_round 25: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:30:56,473 | server.py:236 | fit_round 25 received 4 results and 0 failures
INFO flwr 2024-01-09 19:31:14,140 | server.py:125 | fit progress: (25, None, {'val_f1': 0.807, 'test_f1': 0.803, 'val_precision': 0.744, 'test_precision': 0.739, 'val_recall': 0.882, 'test_recall': 0.879, 'val_accuracy': 0.835, 'test_accuracy': 0.826}, 2530.6275003552437)
INFO flwr 2024-01-09 19:31:14,141 | server.py:171 | evaluate_round 25: no clients selected, cancel
DEBUG flwr 2024-01-09 19:31:14,141 | server.py:222 | fit_round 26: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:32:35,389 | server.py:236 | fit_round 26 received 4 results and 0 failures
INFO flwr 2024-01-09 19:32:53,655 | server.py:125 | fit progress: (26, None, {'val_f1': 0.807, 'test_f1': 0.803, 'val_precision': 0.747, 'test_precision': 0.743, 'val_recall': 0.877, 'test_recall': 0.875, 'val_accuracy': 0.835, 'test_accuracy': 0.827}, 2630.142875273712)
INFO flwr 2024-01-09 19:32:53,656 | server.py:171 | evaluate_round 26: no clients selected, cancel
DEBUG flwr 2024-01-09 19:32:53,656 | server.py:222 | fit_round 27: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:34:12,804 | server.py:236 | fit_round 27 received 4 results and 0 failures
INFO flwr 2024-01-09 19:34:31,726 | server.py:125 | fit progress: (27, None, {'val_f1': 0.808, 'test_f1': 0.804, 'val_precision': 0.749, 'test_precision': 0.744, 'val_recall': 0.877, 'test_recall': 0.875, 'val_accuracy': 0.835, 'test_accuracy': 0.828}, 2728.2139412993565)
INFO flwr 2024-01-09 19:34:31,727 | server.py:171 | evaluate_round 27: no clients selected, cancel
DEBUG flwr 2024-01-09 19:34:31,727 | server.py:222 | fit_round 28: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:35:52,456 | server.py:236 | fit_round 28 received 4 results and 0 failures
INFO flwr 2024-01-09 19:36:11,391 | server.py:125 | fit progress: (28, None, {'val_f1': 0.809, 'test_f1': 0.804, 'val_precision': 0.746, 'test_precision': 0.741, 'val_recall': 0.883, 'test_recall': 0.88, 'val_accuracy': 0.835, 'test_accuracy': 0.827}, 2827.878790633753)
INFO flwr 2024-01-09 19:36:11,392 | server.py:171 | evaluate_round 28: no clients selected, cancel
DEBUG flwr 2024-01-09 19:36:11,392 | server.py:222 | fit_round 29: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:37:31,533 | server.py:236 | fit_round 29 received 4 results and 0 failures
INFO flwr 2024-01-09 19:37:49,149 | server.py:125 | fit progress: (29, None, {'val_f1': 0.809, 'test_f1': 0.806, 'val_precision': 0.745, 'test_precision': 0.741, 'val_recall': 0.886, 'test_recall': 0.883, 'val_accuracy': 0.836, 'test_accuracy': 0.828}, 2925.6364966910332)
INFO flwr 2024-01-09 19:37:49,150 | server.py:171 | evaluate_round 29: no clients selected, cancel
DEBUG flwr 2024-01-09 19:37:49,150 | server.py:222 | fit_round 30: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:39:10,911 | server.py:236 | fit_round 30 received 4 results and 0 failures
INFO flwr 2024-01-09 19:39:29,910 | server.py:125 | fit progress: (30, None, {'val_f1': 0.81, 'test_f1': 0.806, 'val_precision': 0.751, 'test_precision': 0.746, 'val_recall': 0.879, 'test_recall': 0.876, 'val_accuracy': 0.837, 'test_accuracy': 0.829}, 3026.3976971507072)
INFO flwr 2024-01-09 19:39:29,911 | server.py:171 | evaluate_round 30: no clients selected, cancel
INFO flwr 2024-01-09 19:39:29,911 | server.py:153 | FL finished in 3026.39860008657
INFO flwr 2024-01-09 19:39:29,915 | app.py:226 | app_fit: losses_distributed []
INFO flwr 2024-01-09 19:39:29,915 | app.py:227 | app_fit: metrics_distributed_fit {'avg_cval': [(1, {'F1': 0.7614, 'Precision': 0.6825, 'Recall': 0.8634, 'Threshold': 0.7678}), (2, {'F1': 0.7668, 'Precision': 0.6859, 'Recall': 0.875, 'Threshold': 0.7482}), (3, {'F1': 0.7709, 'Precision': 0.6837, 'Recall': 0.8843, 'Threshold': 0.7555}), (4, {'F1': 0.7819, 'Precision': 0.7207, 'Recall': 0.8549, 'Threshold': 0.7793}), (5, {'F1': 0.7859, 'Precision': 0.7178, 'Recall': 0.8704, 'Threshold': 0.7647}), (6, {'F1': 0.7805, 'Precision': 0.7158, 'Recall': 0.8611, 'Threshold': 0.7668}), (7, {'F1': 0.7822, 'Precision': 0.7403, 'Recall': 0.8292, 'Threshold': 0.7937}), (8, {'F1': 0.7846, 'Precision': 0.7245, 'Recall': 0.8565, 'Threshold': 0.7784}), (9, {'F1': 0.7718, 'Precision': 0.7308, 'Recall': 0.8179, 'Threshold': 0.7932}), (10, {'F1': 0.7751, 'Precision': 0.7137, 'Recall': 0.8498, 'Threshold': 0.7698}), (11, {'F1': 0.7934, 'Precision': 0.7346, 'Recall': 0.8634, 'Threshold': 0.768}), (12, {'F1': 0.7887, 'Precision': 0.7246, 'Recall': 0.8665, 'Threshold': 0.7629}), (13, {'F1': 0.7944, 'Precision': 0.7408, 'Recall': 0.8588, 'Threshold': 0.7794}), (14, {'F1': 0.7865, 'Precision': 0.7232, 'Recall': 0.8627, 'Threshold': 0.7683}), (15, {'F1': 0.7865, 'Precision': 0.7211, 'Recall': 0.8681, 'Threshold': 0.761}), (16, {'F1': 0.7856, 'Precision': 0.7143, 'Recall': 0.875, 'Threshold': 0.7493}), (17, {'F1': 0.792, 'Precision': 0.7282, 'Recall': 0.8711, 'Threshold': 0.7612}), (18, {'F1': 0.7905, 'Precision': 0.7259, 'Recall': 0.8681, 'Threshold': 0.7702}), (19, {'F1': 0.7949, 'Precision': 0.7387, 'Recall': 0.8611, 'Threshold': 0.7807}), (20, {'F1': 0.7996, 'Precision': 0.7676, 'Recall': 0.8387, 'Threshold': 0.7941}), (21, {'F1': 0.7925, 'Precision': 0.7438, 'Recall': 0.8511, 'Threshold': 0.7721}), (22, {'F1': 0.7927, 'Precision': 0.7269, 'Recall': 0.8742, 'Threshold': 0.7541}), (23, {'F1': 0.7945, 'Precision': 0.7342, 'Recall': 0.8711, 'Threshold': 0.758}), (24, {'F1': 0.7872, 'Precision': 0.7033, 'Recall': 0.8951, 'Threshold': 0.7346}), (25, {'F1': 0.7965, 'Precision': 0.7495, 'Recall': 0.8503, 'Threshold': 0.7786}), (26, {'F1': 0.7842, 'Precision': 0.7133, 'Recall': 0.8727, 'Threshold': 0.7427}), (27, {'F1': 0.7975, 'Precision': 0.7471, 'Recall': 0.8573, 'Threshold': 0.7652}), (28, {'F1': 0.7969, 'Precision': 0.731, 'Recall': 0.8773, 'Threshold': 0.7611}), (29, {'F1': 0.8003, 'Precision': 0.739, 'Recall': 0.8735, 'Threshold': 0.7622}), (30, {'F1': 0.7881, 'Precision': 0.7268, 'Recall': 0.8619, 'Threshold': 0.765})], 'avg_ctest': [(1, {'F1': 0.7527, 'Precision': 0.6771, 'Recall': 0.8503, 'Threshold': 0.7678}), (2, {'F1': 0.7556, 'Precision': 0.669, 'Recall': 0.8719, 'Threshold': 0.7482}), (3, {'F1': 0.7679, 'Precision': 0.6853, 'Recall': 0.8741, 'Threshold': 0.7555}), (4, {'F1': 0.7576, 'Precision': 0.7027, 'Recall': 0.8225, 'Threshold': 0.7793}), (5, {'F1': 0.7579, 'Precision': 0.6901, 'Recall': 0.8418, 'Threshold': 0.7647}), (6, {'F1': 0.7601, 'Precision': 0.7001, 'Recall': 0.8363, 'Threshold': 0.7668}), (7, {'F1': 0.766, 'Precision': 0.7416, 'Recall': 0.7932, 'Threshold': 0.7937}), (8, {'F1': 0.7684, 'Precision': 0.7148, 'Recall': 0.831, 'Threshold': 0.7784}), (9, {'F1': 0.7731, 'Precision': 0.7441, 'Recall': 0.8066, 'Threshold': 0.7932}), (10, {'F1': 0.7592, 'Precision': 0.6925, 'Recall': 0.8426, 'Threshold': 0.7698}), (11, {'F1': 0.7624, 'Precision': 0.6965, 'Recall': 0.8426, 'Threshold': 0.768}), (12, {'F1': 0.7713, 'Precision': 0.7044, 'Recall': 0.8526, 'Threshold': 0.7629}), (13, {'F1': 0.7785, 'Precision': 0.7439, 'Recall': 0.8194, 'Threshold': 0.7794}), (14, {'F1': 0.7761, 'Precision': 0.7176, 'Recall': 0.8472, 'Threshold': 0.7683}), (15, {'F1': 0.7745, 'Precision': 0.7159, 'Recall': 0.8464, 'Threshold': 0.761}), (16, {'F1': 0.7698, 'Precision': 0.6965, 'Recall': 0.8618, 'Threshold': 0.7493}), (17, {'F1': 0.7785, 'Precision': 0.7257, 'Recall': 0.8425, 'Threshold': 0.7612}), (18, {'F1': 0.7751, 'Precision': 0.7206, 'Recall': 0.8395, 'Threshold': 0.7702}), (19, {'F1': 0.7785, 'Precision': 0.7346, 'Recall': 0.8287, 'Threshold': 0.7807}), (20, {'F1': 0.7777, 'Precision': 0.7624, 'Recall': 0.7986, 'Threshold': 0.7941}), (21, {'F1': 0.77, 'Precision': 0.7275, 'Recall': 0.8225, 'Threshold': 0.7721}), (22, {'F1': 0.7797, 'Precision': 0.7162, 'Recall': 0.8572, 'Threshold': 0.7541}), (23, {'F1': 0.7725, 'Precision': 0.7193, 'Recall': 0.8402, 'Threshold': 0.758}), (24, {'F1': 0.773, 'Precision': 0.688, 'Recall': 0.8827, 'Threshold': 0.7346}), (25, {'F1': 0.7844, 'Precision': 0.7491, 'Recall': 0.8241, 'Threshold': 0.7786}), (26, {'F1': 0.7877, 'Precision': 0.7187, 'Recall': 0.875, 'Threshold': 0.7427}), (27, {'F1': 0.7813, 'Precision': 0.7321, 'Recall': 0.8387, 'Threshold': 0.7652}), (28, {'F1': 0.7783, 'Precision': 0.7183, 'Recall': 0.8511, 'Threshold': 0.7611}), (29, {'F1': 0.7722, 'Precision': 0.7135, 'Recall': 0.8418, 'Threshold': 0.7622}), (30, {'F1': 0.7779, 'Precision': 0.7262, 'Recall': 0.8394, 'Threshold': 0.765})]}
INFO flwr 2024-01-09 19:39:29,915 | app.py:228 | app_fit: metrics_distributed {}
INFO flwr 2024-01-09 19:39:29,915 | app.py:229 | app_fit: losses_centralized [(0, None), (1, None), (2, None), (3, None), (4, None), (5, None), (6, None), (7, None), (8, None), (9, None), (10, None), (11, None), (12, None), (13, None), (14, None), (15, None), (16, None), (17, None), (18, None), (19, None), (20, None), (21, None), (22, None), (23, None), (24, None), (25, None), (26, None), (27, None), (28, None), (29, None), (30, None)]
INFO flwr 2024-01-09 19:39:29,915 | app.py:230 | app_fit: metrics_centralized {'val_f1': [(0, 0.745), (1, 0.773), (2, 0.781), (3, 0.786), (4, 0.787), (5, 0.789), (6, 0.791), (7, 0.791), (8, 0.794), (9, 0.795), (10, 0.796), (11, 0.797), (12, 0.799), (13, 0.8), (14, 0.801), (15, 0.801), (16, 0.802), (17, 0.802), (18, 0.803), (19, 0.805), (20, 0.805), (21, 0.805), (22, 0.806), (23, 0.806), (24, 0.807), (25, 0.807), (26, 0.807), (27, 0.808), (28, 0.809), (29, 0.809), (30, 0.81)], 'test_f1': [(0, 0.743), (1, 0.768), (2, 0.774), (3, 0.78), (4, 0.783), (5, 0.785), (6, 0.787), (7, 0.787), (8, 0.791), (9, 0.791), (10, 0.793), (11, 0.793), (12, 0.795), (13, 0.796), (14, 0.797), (15, 0.797), (16, 0.797), (17, 0.798), (18, 0.799), (19, 0.8), (20, 0.801), (21, 0.802), (22, 0.802), (23, 0.802), (24, 0.802), (25, 0.803), (26, 0.803), (27, 0.804), (28, 0.804), (29, 0.806), (30, 0.806)], 'val_precision': [(0, 0.639), (1, 0.696), (2, 0.708), (3, 0.721), (4, 0.715), (5, 0.707), (6, 0.711), (7, 0.72), (8, 0.722), (9, 0.723), (10, 0.725), (11, 0.722), (12, 0.727), (13, 0.725), (14, 0.733), (15, 0.735), (16, 0.732), (17, 0.739), (18, 0.735), (19, 0.739), (20, 0.741), (21, 0.745), (22, 0.743), (23, 0.746), (24, 0.748), (25, 0.744), (26, 0.747), (27, 0.749), (28, 0.746), (29, 0.745), (30, 0.751)], 'test_precision': [(0, 0.636), (1, 0.691), (2, 0.701), (3, 0.715), (4, 0.71), (5, 0.703), (6, 0.706), (7, 0.715), (8, 0.717), (9, 0.717), (10, 0.72), (11, 0.717), (12, 0.723), (13, 0.72), (14, 0.729), (15, 0.73), (16, 0.726), (17, 0.734), (18, 0.729), (19, 0.734), (20, 0.736), (21, 0.741), (22, 0.739), (23, 0.742), (24, 0.743), (25, 0.739), (26, 0.743), (27, 0.744), (28, 0.741), (29, 0.741), (30, 0.746)], 'val_recall': [(0, 0.895), (1, 0.868), (2, 0.871), (3, 0.863), (4, 0.874), (5, 0.892), (6, 0.89), (7, 0.877), (8, 0.882), (9, 0.883), (10, 0.883), (11, 0.89), (12, 0.885), (13, 0.892), (14, 0.882), (15, 0.879), (16, 0.885), (17, 0.876), (18, 0.886), (19, 0.883), (20, 0.882), (21, 0.876), (22, 0.88), (23, 0.876), (24, 0.875), (25, 0.882), (26, 0.877), (27, 0.877), (28, 0.883), (29, 0.886), (30, 0.879)], 'test_recall': [(0, 0.894), (1, 0.864), (2, 0.864), (3, 0.859), (4, 0.872), (5, 0.891), (6, 0.89), (7, 0.876), (8, 0.881), (9, 0.881), (10, 0.881), (11, 0.887), (12, 0.884), (13, 0.889), (14, 0.88), (15, 0.876), (16, 0.883), (17, 0.873), (18, 0.883), (19, 0.88), (20, 0.878), (21, 0.874), (22, 0.877), (23, 0.873), (24, 0.872), (25, 0.879), (26, 0.875), (27, 0.875), (28, 0.88), (29, 0.883), (30, 0.876)], 'val_accuracy': [(0, 0.768), (1, 0.799), (2, 0.808), (3, 0.813), (4, 0.814), (5, 0.817), (6, 0.819), (7, 0.819), (8, 0.821), (9, 0.823), (10, 0.824), (11, 0.825), (12, 0.826), (13, 0.828), (14, 0.828), (15, 0.828), (16, 0.829), (17, 0.83), (18, 0.831), (19, 0.831), (20, 0.833), (21, 0.833), (22, 0.834), (23, 0.834), (24, 0.834), (25, 0.835), (26, 0.835), (27, 0.835), (28, 0.835), (29, 0.836), (30, 0.837)], 'test_accuracy': [(0, 0.751), (1, 0.789), (2, 0.797), (3, 0.804), (4, 0.804), (5, 0.804), (6, 0.806), (7, 0.809), (8, 0.811), (9, 0.812), (10, 0.814), (11, 0.813), (12, 0.816), (13, 0.816), (14, 0.819), (15, 0.819), (16, 0.818), (17, 0.821), (18, 0.821), (19, 0.823), (20, 0.824), (21, 0.826), (22, 0.826), (23, 0.826), (24, 0.827), (25, 0.826), (26, 0.827), (27, 0.828), (28, 0.827), (29, 0.828), (30, 0.829)]}
Starting Simulation ..
> Hit: Dataset Distribution found in cache: quora-20-412
Experiment Key: tname-multi-qa-MiniLM-L6-cos-v1-dname-quora-clients_per_round-4-num_clients-20-batch_size-412-device-cuda-client_epochs-6-num_rounds-30-
> Starting Simulation ..
avg_cval: {'F1': 0.7614, 'Precision': 0.6825, 'Recall': 0.8634, 'Threshold': 0.7678}
avg_ctest: {'F1': 0.7527, 'Precision': 0.6771, 'Recall': 0.8503, 'Threshold': 0.7678}
avg_cval: {'F1': 0.7668, 'Precision': 0.6859, 'Recall': 0.875, 'Threshold': 0.7482}
avg_ctest: {'F1': 0.7556, 'Precision': 0.669, 'Recall': 0.8719, 'Threshold': 0.7482}
avg_cval: {'F1': 0.7709, 'Precision': 0.6837, 'Recall': 0.8843, 'Threshold': 0.7555}
avg_ctest: {'F1': 0.7679, 'Precision': 0.6853, 'Recall': 0.8741, 'Threshold': 0.7555}
avg_cval: {'F1': 0.7819, 'Precision': 0.7207, 'Recall': 0.8549, 'Threshold': 0.7793}
avg_ctest: {'F1': 0.7576, 'Precision': 0.7027, 'Recall': 0.8225, 'Threshold': 0.7793}
avg_cval: {'F1': 0.7859, 'Precision': 0.7178, 'Recall': 0.8704, 'Threshold': 0.7647}
avg_ctest: {'F1': 0.7579, 'Precision': 0.6901, 'Recall': 0.8418, 'Threshold': 0.7647}
avg_cval: {'F1': 0.7805, 'Precision': 0.7158, 'Recall': 0.8611, 'Threshold': 0.7668}
avg_ctest: {'F1': 0.7601, 'Precision': 0.7001, 'Recall': 0.8363, 'Threshold': 0.7668}
avg_cval: {'F1': 0.7822, 'Precision': 0.7403, 'Recall': 0.8292, 'Threshold': 0.7937}
avg_ctest: {'F1': 0.766, 'Precision': 0.7416, 'Recall': 0.7932, 'Threshold': 0.7937}
avg_cval: {'F1': 0.7846, 'Precision': 0.7245, 'Recall': 0.8565, 'Threshold': 0.7784}
avg_ctest: {'F1': 0.7684, 'Precision': 0.7148, 'Recall': 0.831, 'Threshold': 0.7784}
avg_cval: {'F1': 0.7718, 'Precision': 0.7308, 'Recall': 0.8179, 'Threshold': 0.7932}
avg_ctest: {'F1': 0.7731, 'Precision': 0.7441, 'Recall': 0.8066, 'Threshold': 0.7932}
avg_cval: {'F1': 0.7751, 'Precision': 0.7137, 'Recall': 0.8498, 'Threshold': 0.7698}
avg_ctest: {'F1': 0.7592, 'Precision': 0.6925, 'Recall': 0.8426, 'Threshold': 0.7698}
avg_cval: {'F1': 0.7934, 'Precision': 0.7346, 'Recall': 0.8634, 'Threshold': 0.768}
avg_ctest: {'F1': 0.7624, 'Precision': 0.6965, 'Recall': 0.8426, 'Threshold': 0.768}
avg_cval: {'F1': 0.7887, 'Precision': 0.7246, 'Recall': 0.8665, 'Threshold': 0.7629}
avg_ctest: {'F1': 0.7713, 'Precision': 0.7044, 'Recall': 0.8526, 'Threshold': 0.7629}
avg_cval: {'F1': 0.7944, 'Precision': 0.7408, 'Recall': 0.8588, 'Threshold': 0.7794}
avg_ctest: {'F1': 0.7785, 'Precision': 0.7439, 'Recall': 0.8194, 'Threshold': 0.7794}
avg_cval: {'F1': 0.7865, 'Precision': 0.7232, 'Recall': 0.8627, 'Threshold': 0.7683}
avg_ctest: {'F1': 0.7761, 'Precision': 0.7176, 'Recall': 0.8472, 'Threshold': 0.7683}
avg_cval: {'F1': 0.7865, 'Precision': 0.7211, 'Recall': 0.8681, 'Threshold': 0.761}
avg_ctest: {'F1': 0.7745, 'Precision': 0.7159, 'Recall': 0.8464, 'Threshold': 0.761}
avg_cval: {'F1': 0.7856, 'Precision': 0.7143, 'Recall': 0.875, 'Threshold': 0.7493}
avg_ctest: {'F1': 0.7698, 'Precision': 0.6965, 'Recall': 0.8618, 'Threshold': 0.7493}
avg_cval: {'F1': 0.792, 'Precision': 0.7282, 'Recall': 0.8711, 'Threshold': 0.7612}
avg_ctest: {'F1': 0.7785, 'Precision': 0.7257, 'Recall': 0.8425, 'Threshold': 0.7612}
avg_cval: {'F1': 0.7905, 'Precision': 0.7259, 'Recall': 0.8681, 'Threshold': 0.7702}
avg_ctest: {'F1': 0.7751, 'Precision': 0.7206, 'Recall': 0.8395, 'Threshold': 0.7702}
avg_cval: {'F1': 0.7949, 'Precision': 0.7387, 'Recall': 0.8611, 'Threshold': 0.7807}
avg_ctest: {'F1': 0.7785, 'Precision': 0.7346, 'Recall': 0.8287, 'Threshold': 0.7807}
avg_cval: {'F1': 0.7996, 'Precision': 0.7676, 'Recall': 0.8387, 'Threshold': 0.7941}
avg_ctest: {'F1': 0.7777, 'Precision': 0.7624, 'Recall': 0.7986, 'Threshold': 0.7941}
avg_cval: {'F1': 0.7925, 'Precision': 0.7438, 'Recall': 0.8511, 'Threshold': 0.7721}
avg_ctest: {'F1': 0.77, 'Precision': 0.7275, 'Recall': 0.8225, 'Threshold': 0.7721}
avg_cval: {'F1': 0.7927, 'Precision': 0.7269, 'Recall': 0.8742, 'Threshold': 0.7541}
avg_ctest: {'F1': 0.7797, 'Precision': 0.7162, 'Recall': 0.8572, 'Threshold': 0.7541}
avg_cval: {'F1': 0.7945, 'Precision': 0.7342, 'Recall': 0.8711, 'Threshold': 0.758}
avg_ctest: {'F1': 0.7725, 'Precision': 0.7193, 'Recall': 0.8402, 'Threshold': 0.758}
avg_cval: {'F1': 0.7872, 'Precision': 0.7033, 'Recall': 0.8951, 'Threshold': 0.7346}
avg_ctest: {'F1': 0.773, 'Precision': 0.688, 'Recall': 0.8827, 'Threshold': 0.7346}
avg_cval: {'F1': 0.7965, 'Precision': 0.7495, 'Recall': 0.8503, 'Threshold': 0.7786}
avg_ctest: {'F1': 0.7844, 'Precision': 0.7491, 'Recall': 0.8241, 'Threshold': 0.7786}
avg_cval: {'F1': 0.7842, 'Precision': 0.7133, 'Recall': 0.8727, 'Threshold': 0.7427}
avg_ctest: {'F1': 0.7877, 'Precision': 0.7187, 'Recall': 0.875, 'Threshold': 0.7427}
avg_cval: {'F1': 0.7975, 'Precision': 0.7471, 'Recall': 0.8573, 'Threshold': 0.7652}
avg_ctest: {'F1': 0.7813, 'Precision': 0.7321, 'Recall': 0.8387, 'Threshold': 0.7652}
avg_cval: {'F1': 0.7969, 'Precision': 0.731, 'Recall': 0.8773, 'Threshold': 0.7611}
avg_ctest: {'F1': 0.7783, 'Precision': 0.7183, 'Recall': 0.8511, 'Threshold': 0.7611}
avg_cval: {'F1': 0.8003, 'Precision': 0.739, 'Recall': 0.8735, 'Threshold': 0.7622}
avg_ctest: {'F1': 0.7722, 'Precision': 0.7135, 'Recall': 0.8418, 'Threshold': 0.7622}
avg_cval: {'F1': 0.7881, 'Precision': 0.7268, 'Recall': 0.8619, 'Threshold': 0.765}
avg_ctest: {'F1': 0.7779, 'Precision': 0.7262, 'Recall': 0.8394, 'Threshold': 0.765}
> Simulation Completed
/home/waris/.conda/envs/llm/lib/python3.11/site-packages/numpy/core/fromnumeric.py:59: FutureWarning: 'DataFrame.swapaxes' is deprecated and will be removed in a future version. Please use 'DataFrame.transpose' instead.
  return bound(*args, **kwds)
WARNING flwr 2024-01-09 19:40:27,441 | fedavg.py:117 | 
Setting `min_available_clients` lower than `min_fit_clients` or
`min_evaluate_clients` can cause the server to fail when there are too few clients
connected to the server. `min_available_clients` must be set to a value larger
than or equal to the values of `min_fit_clients` and `min_evaluate_clients`.

INFO flwr 2024-01-09 19:40:27,442 | app.py:178 | Starting Flower simulation, config: ServerConfig(num_rounds=30, round_timeout=None)
2024-01-09 19:40:31,267	INFO worker.py:1724 -- Started a local Ray instance.
INFO flwr 2024-01-09 19:40:32,614 | app.py:213 | Flower VCE: Ray initialized with resources: {'CPU': 32.0, 'accelerator_type:A100': 1.0, 'memory': 1146214427648.0, 'object_store_memory': 200000000000.0, 'node:10.128.9.202': 1.0, 'GPU': 4.0, 'node:__internal_head__': 1.0}
INFO flwr 2024-01-09 19:40:32,614 | app.py:219 | Optimize your simulation with Flower VCE: https://flower.dev/docs/framework/how-to-run-simulations.html
INFO flwr 2024-01-09 19:40:32,614 | app.py:242 | Flower VCE: Resources for each Virtual Client: {'num_cpus': 3, 'num_gpus': 1}
INFO flwr 2024-01-09 19:40:32,624 | app.py:288 | Flower VCE: Creating VirtualClientEngineActorPool with 4 actors
INFO flwr 2024-01-09 19:40:32,624 | server.py:89 | Initializing global parameters
INFO flwr 2024-01-09 19:40:32,624 | server.py:276 | Requesting initial parameters from one random client
[36m(DefaultActor pid=68181)[0m .gitattributes:   0%|          | 0.00/737 [00:00<?, ?B/s].gitattributes: 100%|██████████| 737/737 [00:00<00:00, 6.93MB/s]
[36m(DefaultActor pid=68181)[0m 1_Pooling/config.json:   0%|          | 0.00/190 [00:00<?, ?B/s]1_Pooling/config.json: 100%|██████████| 190/190 [00:00<00:00, 2.47MB/s]
[36m(DefaultActor pid=68181)[0m README.md:   0%|          | 0.00/9.47k [00:00<?, ?B/s]README.md: 100%|██████████| 9.47k/9.47k [00:00<00:00, 111MB/s]
[36m(DefaultActor pid=68181)[0m config.json:   0%|          | 0.00/523 [00:00<?, ?B/s]config.json: 100%|██████████| 523/523 [00:00<00:00, 3.17MB/s]
[36m(DefaultActor pid=68181)[0m config_sentence_transformers.json:   0%|          | 0.00/116 [00:00<?, ?B/s]config_sentence_transformers.json: 100%|██████████| 116/116 [00:00<00:00, 1.86MB/s]
[36m(DefaultActor pid=68181)[0m data_config.json:   0%|          | 0.00/25.5k [00:00<?, ?B/s]data_config.json: 100%|██████████| 25.5k/25.5k [00:00<00:00, 136MB/s]
[36m(DefaultActor pid=68181)[0m pytorch_model.bin:   0%|          | 0.00/265M [00:00<?, ?B/s]
[36m(DefaultActor pid=68181)[0m pytorch_model.bin:   8%|▊         | 21.0M/265M [00:00<00:01, 189MB/s]
[36m(DefaultActor pid=68181)[0m pytorch_model.bin:  16%|█▌        | 41.9M/265M [00:00<00:01, 175MB/s]
[36m(DefaultActor pid=68181)[0m pytorch_model.bin:  28%|██▊       | 73.4M/265M [00:00<00:00, 209MB/s]
[36m(DefaultActor pid=68181)[0m pytorch_model.bin:  36%|███▌      | 94.4M/265M [00:00<00:00, 186MB/s]
[36m(DefaultActor pid=68181)[0m pytorch_model.bin:  47%|████▋     | 126M/265M [00:00<00:00, 209MB/s] 
[36m(DefaultActor pid=68181)[0m pytorch_model.bin:  63%|██████▎   | 168M/265M [00:00<00:00, 253MB/s]
[36m(DefaultActor pid=68181)[0m pytorch_model.bin:  75%|███████▌  | 199M/265M [00:00<00:00, 269MB/s]
[36m(DefaultActor pid=68181)[0m pytorch_model.bin:  87%|████████▋ | 231M/265M [00:00<00:00, 265MB/s]
[36m(DefaultActor pid=68181)[0m pytorch_model.bin:  99%|█████████▊| 262M/265M [00:01<00:00, 252MB/s]
[36m(DefaultActor pid=68181)[0m pytorch_model.bin: 100%|██████████| 265M/265M [00:01<00:00, 236MB/s]
[36m(DefaultActor pid=68181)[0m sentence_bert_config.json:   0%|          | 0.00/53.0 [00:00<?, ?B/s]sentence_bert_config.json: 100%|██████████| 53.0/53.0 [00:00<00:00, 377kB/s]
[36m(DefaultActor pid=68181)[0m special_tokens_map.json:   0%|          | 0.00/112 [00:00<?, ?B/s]special_tokens_map.json: 100%|██████████| 112/112 [00:00<00:00, 1.88MB/s]
[36m(DefaultActor pid=68181)[0m tokenizer.json:   0%|          | 0.00/466k [00:00<?, ?B/s]tokenizer.json: 100%|██████████| 466k/466k [00:00<00:00, 24.5MB/s]
[36m(DefaultActor pid=68181)[0m tokenizer_config.json:   0%|          | 0.00/333 [00:00<?, ?B/s]tokenizer_config.json: 100%|██████████| 333/333 [00:00<00:00, 5.87MB/s]
[36m(DefaultActor pid=68181)[0m train_script.py:   0%|          | 0.00/13.8k [00:00<?, ?B/s]train_script.py: 100%|██████████| 13.8k/13.8k [00:00<00:00, 206MB/s]
[36m(DefaultActor pid=68181)[0m vocab.txt:   0%|          | 0.00/232k [00:00<?, ?B/s]vocab.txt: 100%|██████████| 232k/232k [00:00<00:00, 76.7MB/s]
[36m(DefaultActor pid=68181)[0m modules.json:   0%|          | 0.00/349 [00:00<?, ?B/s]modules.json: 100%|██████████| 349/349 [00:00<00:00, 5.93MB/s]
INFO flwr 2024-01-09 19:40:52,246 | server.py:280 | Received initial parameters from one random client
INFO flwr 2024-01-09 19:40:52,246 | server.py:91 | Evaluating initial parameters
INFO flwr 2024-01-09 19:41:26,565 | server.py:94 | initial parameters (loss, other metrics): None, {'val_f1': 0.754, 'test_f1': 0.752, 'val_precision': 0.648, 'test_precision': 0.647, 'val_recall': 0.901, 'test_recall': 0.898, 'val_accuracy': 0.778, 'test_accuracy': 0.761}
INFO flwr 2024-01-09 19:41:26,566 | server.py:104 | FL starting
DEBUG flwr 2024-01-09 19:41:26,566 | server.py:222 | fit_round 1: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:44:49,938 | server.py:236 | fit_round 1 received 4 results and 0 failures
INFO flwr 2024-01-09 19:45:23,280 | server.py:125 | fit progress: (1, None, {'val_f1': 0.786, 'test_f1': 0.78, 'val_precision': 0.714, 'test_precision': 0.707, 'val_recall': 0.874, 'test_recall': 0.87, 'val_accuracy': 0.814, 'test_accuracy': 0.802}, 236.71440740581602)
INFO flwr 2024-01-09 19:45:23,281 | server.py:171 | evaluate_round 1: no clients selected, cancel
DEBUG flwr 2024-01-09 19:45:23,281 | server.py:222 | fit_round 2: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:48:42,043 | server.py:236 | fit_round 2 received 4 results and 0 failures
INFO flwr 2024-01-09 19:49:14,793 | server.py:125 | fit progress: (2, None, {'val_f1': 0.793, 'test_f1': 0.788, 'val_precision': 0.729, 'test_precision': 0.723, 'val_recall': 0.869, 'test_recall': 0.866, 'val_accuracy': 0.823, 'test_accuracy': 0.812}, 468.2272890228778)
INFO flwr 2024-01-09 19:49:14,794 | server.py:171 | evaluate_round 2: no clients selected, cancel
DEBUG flwr 2024-01-09 19:49:14,794 | server.py:222 | fit_round 3: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:52:39,895 | server.py:236 | fit_round 3 received 4 results and 0 failures
INFO flwr 2024-01-09 19:53:12,339 | server.py:125 | fit progress: (3, None, {'val_f1': 0.798, 'test_f1': 0.793, 'val_precision': 0.742, 'test_precision': 0.736, 'val_recall': 0.862, 'test_recall': 0.861, 'val_accuracy': 0.828, 'test_accuracy': 0.819}, 705.7729653008282)
INFO flwr 2024-01-09 19:53:12,340 | server.py:171 | evaluate_round 3: no clients selected, cancel
DEBUG flwr 2024-01-09 19:53:12,340 | server.py:222 | fit_round 4: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 19:56:47,597 | server.py:236 | fit_round 4 received 4 results and 0 failures
INFO flwr 2024-01-09 19:57:20,658 | server.py:125 | fit progress: (4, None, {'val_f1': 0.802, 'test_f1': 0.797, 'val_precision': 0.746, 'test_precision': 0.74, 'val_recall': 0.866, 'test_recall': 0.865, 'val_accuracy': 0.831, 'test_accuracy': 0.823}, 954.092627633363)
INFO flwr 2024-01-09 19:57:20,659 | server.py:171 | evaluate_round 4: no clients selected, cancel
DEBUG flwr 2024-01-09 19:57:20,659 | server.py:222 | fit_round 5: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 20:00:38,397 | server.py:236 | fit_round 5 received 4 results and 0 failures
INFO flwr 2024-01-09 20:01:09,860 | server.py:125 | fit progress: (5, None, {'val_f1': 0.804, 'test_f1': 0.8, 'val_precision': 0.736, 'test_precision': 0.73, 'val_recall': 0.886, 'test_recall': 0.885, 'val_accuracy': 0.834, 'test_accuracy': 0.822}, 1183.2945042708889)
INFO flwr 2024-01-09 20:01:09,861 | server.py:171 | evaluate_round 5: no clients selected, cancel
DEBUG flwr 2024-01-09 20:01:09,861 | server.py:222 | fit_round 6: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 20:04:25,215 | server.py:236 | fit_round 6 received 4 results and 0 failures
INFO flwr 2024-01-09 20:04:56,937 | server.py:125 | fit progress: (6, None, {'val_f1': 0.807, 'test_f1': 0.802, 'val_precision': 0.759, 'test_precision': 0.752, 'val_recall': 0.861, 'test_recall': 0.86, 'val_accuracy': 0.836, 'test_accuracy': 0.829}, 1410.3714725654572)
INFO flwr 2024-01-09 20:04:56,938 | server.py:171 | evaluate_round 6: no clients selected, cancel
DEBUG flwr 2024-01-09 20:04:56,938 | server.py:222 | fit_round 7: strategy sampled 4 clients (out of 20)
DEBUG flwr 2024-01-09 20:08:15,282 | server.py:236 | fit_round 7 received 4 results and 0 failures
INFO flwr 2024-01-09 20:08:48,438 | server.py:125 | fit progress: (7, None, {'val_f1': 0.808, 'test_f1': 0.805, 'val_precision': 0.763, 'test_precision': 0.755, 'val_recall': 0.86, 'test_recall': 0.861, 'val_accuracy': 0.838, 'test_accuracy': 0.831}, 1641.8721359614283)
INFO flwr 2024-01-09 20:08:48,442 | server.py:171 | evaluate_round 7: no clients selected, cancel
DEBUG flwr 2024-01-09 20:08:48,442 | server.py:222 | fit_round 8: strategy sampled 4 clients (out of 20)
ERROR flwr 2024-01-09 20:11:12,653 | ray_client_proxy.py:145 | Traceback (most recent call last):
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 138, in _submit_job
    res = self.actor_pool.get_client_result(self.cid, timeout)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 414, in get_client_result
    return self._fetch_future_result(cid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 300, in _fetch_future_result
    res_cid, res = ray.get(future)  # type: (str, ClientRes)
                   ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/auto_init_hook.py", line 22, in auto_init_wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/worker.py", line 2624, in get
    raise value.as_instanceof_cause()
ray.exceptions.RayTaskError(ClientException): [36mray::DefaultActor.run()[39m (pid=68181, ip=10.128.9.202, actor_id=79896e56d0c45dda0aa58ed901000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2ada0c014550>)
                  ^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit
    return maybe_call_fit(
           ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit
    return client.fit(fit_ins)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit
    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit
    self.net, val_results, test_results = _trainTransformer(
                                          ^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer
    model.fit(
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit
    loss_value = loss_model(features, labels)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
            ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward
    output_states = self.auto_model(**trans_features, return_dict=False)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 820, in forward
    return self.transformer(
           ^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 585, in forward
    layer_outputs = layer_module(
                    ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 511, in forward
    sa_output = self.attention(
                ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 242, in forward
    q = q / math.sqrt(dim_per_head)  # (bs, n_heads, q_length, dim_per_head)
        ~~^~~~~~~~~~~~~~~~~~~~~~~~~
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 262.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 180.12 MiB is free. Including non-PyTorch memory, this process has 79.17 GiB memory in use. Of the allocated memory 74.66 GiB is allocated by PyTorch, and 3.22 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

The above exception was the direct cause of the following exception:

[36mray::DefaultActor.run()[39m (pid=68181, ip=10.128.9.202, actor_id=79896e56d0c45dda0aa58ed901000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2ada0c014550>)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 84, in run
    raise ClientException(str(message)) from ex
flwr.simulation.ray_transport.ray_actor.ClientException: 
>>>>>>>A ClientException occurred.('\n\tSomething went wrong when running your client workload.\n\tClient 2 crashed when the DefaultActor was running its workload.\n\tException triggered on the client side: Traceback (most recent call last):\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 72, in run\n    job_results = job_fn(client)\n                  ^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit\n    return maybe_call_fit(\n           ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit\n    return client.fit(fit_ins)\n           ^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit\n    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit\n    self.net, val_results, test_results = _trainTransformer(\n                                          ^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer\n    model.fit(\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit\n    loss_value = loss_model(features, labels)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward\n    input = module(input)\n            ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward\n    output_states = self.auto_model(**trans_features, return_dict=False)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 820, in forward\n    return self.transformer(\n           ^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 585, in forward\n    layer_outputs = layer_module(\n                    ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 511, in forward\n    sa_output = self.attention(\n                ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 242, in forward\n    q = q / math.sqrt(dim_per_head)  # (bs, n_heads, q_length, dim_per_head)\n        ~~^~~~~~~~~~~~~~~~~~~~~~~~~\ntorch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 262.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 180.12 MiB is free. Including non-PyTorch memory, this process has 79.17 GiB memory in use. Of the allocated memory 74.66 GiB is allocated by PyTorch, and 3.22 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\n',)

ERROR flwr 2024-01-09 20:11:12,653 | ray_client_proxy.py:146 | [36mray::DefaultActor.run()[39m (pid=68181, ip=10.128.9.202, actor_id=79896e56d0c45dda0aa58ed901000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2ada0c014550>)
                  ^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit
    return maybe_call_fit(
           ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit
    return client.fit(fit_ins)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit
    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit
    self.net, val_results, test_results = _trainTransformer(
                                          ^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer
    model.fit(
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit
    loss_value = loss_model(features, labels)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
            ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward
    output_states = self.auto_model(**trans_features, return_dict=False)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 820, in forward
    return self.transformer(
           ^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 585, in forward
    layer_outputs = layer_module(
                    ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 511, in forward
    sa_output = self.attention(
                ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 242, in forward
    q = q / math.sqrt(dim_per_head)  # (bs, n_heads, q_length, dim_per_head)
        ~~^~~~~~~~~~~~~~~~~~~~~~~~~
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 262.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 180.12 MiB is free. Including non-PyTorch memory, this process has 79.17 GiB memory in use. Of the allocated memory 74.66 GiB is allocated by PyTorch, and 3.22 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

The above exception was the direct cause of the following exception:

[36mray::DefaultActor.run()[39m (pid=68181, ip=10.128.9.202, actor_id=79896e56d0c45dda0aa58ed901000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2ada0c014550>)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 84, in run
    raise ClientException(str(message)) from ex
flwr.simulation.ray_transport.ray_actor.ClientException: 
>>>>>>>A ClientException occurred.('\n\tSomething went wrong when running your client workload.\n\tClient 2 crashed when the DefaultActor was running its workload.\n\tException triggered on the client side: Traceback (most recent call last):\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 72, in run\n    job_results = job_fn(client)\n                  ^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit\n    return maybe_call_fit(\n           ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit\n    return client.fit(fit_ins)\n           ^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit\n    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit\n    self.net, val_results, test_results = _trainTransformer(\n                                          ^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer\n    model.fit(\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit\n    loss_value = loss_model(features, labels)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward\n    input = module(input)\n            ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward\n    output_states = self.auto_model(**trans_features, return_dict=False)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 820, in forward\n    return self.transformer(\n           ^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 585, in forward\n    layer_outputs = layer_module(\n                    ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 511, in forward\n    sa_output = self.attention(\n                ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 242, in forward\n    q = q / math.sqrt(dim_per_head)  # (bs, n_heads, q_length, dim_per_head)\n        ~~^~~~~~~~~~~~~~~~~~~~~~~~~\ntorch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 262.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 180.12 MiB is free. Including non-PyTorch memory, this process has 79.17 GiB memory in use. Of the allocated memory 74.66 GiB is allocated by PyTorch, and 3.22 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\n',)
DEBUG flwr 2024-01-09 20:12:20,051 | server.py:236 | fit_round 8 received 3 results and 1 failures
INFO flwr 2024-01-09 20:12:53,052 | server.py:125 | fit progress: (8, None, {'val_f1': 0.81, 'test_f1': 0.805, 'val_precision': 0.76, 'test_precision': 0.752, 'val_recall': 0.867, 'test_recall': 0.867, 'val_accuracy': 0.839, 'test_accuracy': 0.831}, 1886.4861076381058)
INFO flwr 2024-01-09 20:12:53,053 | server.py:171 | evaluate_round 8: no clients selected, cancel
DEBUG flwr 2024-01-09 20:12:53,053 | server.py:222 | fit_round 9: strategy sampled 4 clients (out of 20)
ERROR flwr 2024-01-09 20:15:05,293 | ray_client_proxy.py:145 | Traceback (most recent call last):
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 138, in _submit_job
    res = self.actor_pool.get_client_result(self.cid, timeout)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 414, in get_client_result
    return self._fetch_future_result(cid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 300, in _fetch_future_result
    res_cid, res = ray.get(future)  # type: (str, ClientRes)
                   ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/auto_init_hook.py", line 22, in auto_init_wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/worker.py", line 2624, in get
    raise value.as_instanceof_cause()
ray.exceptions.RayTaskError(ClientException): [36mray::DefaultActor.run()[39m (pid=68178, ip=10.128.9.202, actor_id=361715b4e385284548c15d6401000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2aab5339a350>)
                  ^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit
    return maybe_call_fit(
           ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit
    return client.fit(fit_ins)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit
    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit
    self.net, val_results, test_results = _trainTransformer(
                                          ^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer
    model.fit(
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit
    loss_value = loss_model(features, labels)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
            ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward
    output_states = self.auto_model(**trans_features, return_dict=False)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 820, in forward
    return self.transformer(
           ^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 585, in forward
    layer_outputs = layer_module(
                    ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 511, in forward
    sa_output = self.attention(
                ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 242, in forward
    q = q / math.sqrt(dim_per_head)  # (bs, n_heads, q_length, dim_per_head)
        ~~^~~~~~~~~~~~~~~~~~~~~~~~~
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 346.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 282.12 MiB is free. Process 65810 has 7.90 GiB memory in use. Including non-PyTorch memory, this process has 71.16 GiB memory in use. Of the allocated memory 63.14 GiB is allocated by PyTorch, and 6.74 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

The above exception was the direct cause of the following exception:

[36mray::DefaultActor.run()[39m (pid=68178, ip=10.128.9.202, actor_id=361715b4e385284548c15d6401000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2aab5339a350>)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 84, in run
    raise ClientException(str(message)) from ex
flwr.simulation.ray_transport.ray_actor.ClientException: 
>>>>>>>A ClientException occurred.('\n\tSomething went wrong when running your client workload.\n\tClient 11 crashed when the DefaultActor was running its workload.\n\tException triggered on the client side: Traceback (most recent call last):\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 72, in run\n    job_results = job_fn(client)\n                  ^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit\n    return maybe_call_fit(\n           ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit\n    return client.fit(fit_ins)\n           ^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit\n    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit\n    self.net, val_results, test_results = _trainTransformer(\n                                          ^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer\n    model.fit(\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit\n    loss_value = loss_model(features, labels)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward\n    input = module(input)\n            ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward\n    output_states = self.auto_model(**trans_features, return_dict=False)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 820, in forward\n    return self.transformer(\n           ^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 585, in forward\n    layer_outputs = layer_module(\n                    ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 511, in forward\n    sa_output = self.attention(\n                ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 242, in forward\n    q = q / math.sqrt(dim_per_head)  # (bs, n_heads, q_length, dim_per_head)\n        ~~^~~~~~~~~~~~~~~~~~~~~~~~~\ntorch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 346.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 282.12 MiB is free. Process 65810 has 7.90 GiB memory in use. Including non-PyTorch memory, this process has 71.16 GiB memory in use. Of the allocated memory 63.14 GiB is allocated by PyTorch, and 6.74 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\n',)

ERROR flwr 2024-01-09 20:15:05,294 | ray_client_proxy.py:146 | [36mray::DefaultActor.run()[39m (pid=68178, ip=10.128.9.202, actor_id=361715b4e385284548c15d6401000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2aab5339a350>)
                  ^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit
    return maybe_call_fit(
           ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit
    return client.fit(fit_ins)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit
    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit
    self.net, val_results, test_results = _trainTransformer(
                                          ^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer
    model.fit(
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit
    loss_value = loss_model(features, labels)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
            ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward
    output_states = self.auto_model(**trans_features, return_dict=False)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 820, in forward
    return self.transformer(
           ^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 585, in forward
    layer_outputs = layer_module(
                    ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 511, in forward
    sa_output = self.attention(
                ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 242, in forward
    q = q / math.sqrt(dim_per_head)  # (bs, n_heads, q_length, dim_per_head)
        ~~^~~~~~~~~~~~~~~~~~~~~~~~~
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 346.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 282.12 MiB is free. Process 65810 has 7.90 GiB memory in use. Including non-PyTorch memory, this process has 71.16 GiB memory in use. Of the allocated memory 63.14 GiB is allocated by PyTorch, and 6.74 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

The above exception was the direct cause of the following exception:

[36mray::DefaultActor.run()[39m (pid=68178, ip=10.128.9.202, actor_id=361715b4e385284548c15d6401000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2aab5339a350>)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 84, in run
    raise ClientException(str(message)) from ex
flwr.simulation.ray_transport.ray_actor.ClientException: 
>>>>>>>A ClientException occurred.('\n\tSomething went wrong when running your client workload.\n\tClient 11 crashed when the DefaultActor was running its workload.\n\tException triggered on the client side: Traceback (most recent call last):\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 72, in run\n    job_results = job_fn(client)\n                  ^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit\n    return maybe_call_fit(\n           ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit\n    return client.fit(fit_ins)\n           ^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit\n    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit\n    self.net, val_results, test_results = _trainTransformer(\n                                          ^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer\n    model.fit(\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit\n    loss_value = loss_model(features, labels)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward\n    input = module(input)\n            ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward\n    output_states = self.auto_model(**trans_features, return_dict=False)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 820, in forward\n    return self.transformer(\n           ^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 585, in forward\n    layer_outputs = layer_module(\n                    ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 511, in forward\n    sa_output = self.attention(\n                ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 242, in forward\n    q = q / math.sqrt(dim_per_head)  # (bs, n_heads, q_length, dim_per_head)\n        ~~^~~~~~~~~~~~~~~~~~~~~~~~~\ntorch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 346.00 MiB. GPU 0 has a total capacty of 79.35 GiB of which 282.12 MiB is free. Process 65810 has 7.90 GiB memory in use. Including non-PyTorch memory, this process has 71.16 GiB memory in use. Of the allocated memory 63.14 GiB is allocated by PyTorch, and 6.74 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\n',)
DEBUG flwr 2024-01-09 20:16:25,418 | server.py:236 | fit_round 9 received 3 results and 1 failures
INFO flwr 2024-01-09 20:16:58,189 | server.py:125 | fit progress: (9, None, {'val_f1': 0.81, 'test_f1': 0.807, 'val_precision': 0.748, 'test_precision': 0.742, 'val_recall': 0.883, 'test_recall': 0.883, 'val_accuracy': 0.839, 'test_accuracy': 0.829}, 2131.6230386504903)
INFO flwr 2024-01-09 20:16:58,190 | server.py:171 | evaluate_round 9: no clients selected, cancel
DEBUG flwr 2024-01-09 20:16:58,190 | server.py:222 | fit_round 10: strategy sampled 4 clients (out of 20)
ERROR flwr 2024-01-09 20:17:58,010 | ray_client_proxy.py:145 | Traceback (most recent call last):
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 138, in _submit_job
    res = self.actor_pool.get_client_result(self.cid, timeout)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 414, in get_client_result
    return self._fetch_future_result(cid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 300, in _fetch_future_result
    res_cid, res = ray.get(future)  # type: (str, ClientRes)
                   ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/auto_init_hook.py", line 22, in auto_init_wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/ray/_private/worker.py", line 2624, in get
    raise value.as_instanceof_cause()
ray.exceptions.RayTaskError(ClientException): [36mray::DefaultActor.run()[39m (pid=68178, ip=10.128.9.202, actor_id=361715b4e385284548c15d6401000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2aab5339a350>)
                  ^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit
    return maybe_call_fit(
           ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit
    return client.fit(fit_ins)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit
    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit
    self.net, val_results, test_results = _trainTransformer(
                                          ^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer
    model.fit(
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit
    loss_value = loss_model(features, labels)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
            ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward
    output_states = self.auto_model(**trans_features, return_dict=False)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 820, in forward
    return self.transformer(
           ^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 585, in forward
    layer_outputs = layer_module(
                    ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 529, in forward
    ffn_output = self.ffn(sa_output)  # (bs, seq_length, dim)
                 ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 464, in forward
    return apply_chunking_to_forward(self.ff_chunk, self.chunk_size_feed_forward, self.seq_len_dim, input)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/pytorch_utils.py", line 242, in apply_chunking_to_forward
    return forward_fn(*input_tensors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 468, in ff_chunk
    x = self.activation(x)
        ^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/activations.py", line 78, in forward
    return self.act(input)
           ^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.35 GiB. GPU 0 has a total capacty of 79.35 GiB of which 370.12 MiB is free. Process 65810 has 7.90 GiB memory in use. Including non-PyTorch memory, this process has 71.08 GiB memory in use. Of the allocated memory 62.95 GiB is allocated by PyTorch, and 6.85 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

The above exception was the direct cause of the following exception:

[36mray::DefaultActor.run()[39m (pid=68178, ip=10.128.9.202, actor_id=361715b4e385284548c15d6401000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2aab5339a350>)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 84, in run
    raise ClientException(str(message)) from ex
flwr.simulation.ray_transport.ray_actor.ClientException: 
>>>>>>>A ClientException occurred.('\n\tSomething went wrong when running your client workload.\n\tClient 10 crashed when the DefaultActor was running its workload.\n\tException triggered on the client side: Traceback (most recent call last):\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 72, in run\n    job_results = job_fn(client)\n                  ^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit\n    return maybe_call_fit(\n           ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit\n    return client.fit(fit_ins)\n           ^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit\n    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit\n    self.net, val_results, test_results = _trainTransformer(\n                                          ^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer\n    model.fit(\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit\n    loss_value = loss_model(features, labels)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward\n    input = module(input)\n            ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward\n    output_states = self.auto_model(**trans_features, return_dict=False)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 820, in forward\n    return self.transformer(\n           ^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 585, in forward\n    layer_outputs = layer_module(\n                    ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 529, in forward\n    ffn_output = self.ffn(sa_output)  # (bs, seq_length, dim)\n                 ^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 464, in forward\n    return apply_chunking_to_forward(self.ff_chunk, self.chunk_size_feed_forward, self.seq_len_dim, input)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/pytorch_utils.py", line 242, in apply_chunking_to_forward\n    return forward_fn(*input_tensors)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 468, in ff_chunk\n    x = self.activation(x)\n        ^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/activations.py", line 78, in forward\n    return self.act(input)\n           ^^^^^^^^^^^^^^^\ntorch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.35 GiB. GPU 0 has a total capacty of 79.35 GiB of which 370.12 MiB is free. Process 65810 has 7.90 GiB memory in use. Including non-PyTorch memory, this process has 71.08 GiB memory in use. Of the allocated memory 62.95 GiB is allocated by PyTorch, and 6.85 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\n',)

ERROR flwr 2024-01-09 20:17:58,011 | ray_client_proxy.py:146 | [36mray::DefaultActor.run()[39m (pid=68178, ip=10.128.9.202, actor_id=361715b4e385284548c15d6401000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2aab5339a350>)
                  ^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit
    return maybe_call_fit(
           ^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit
    return client.fit(fit_ins)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit
    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit
    self.net, val_results, test_results = _trainTransformer(
                                          ^^^^^^^^^^^^^^^^^^
  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer
    model.fit(
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit
    loss_value = loss_model(features, labels)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>
    embeddings = [self.model(sentence_feature)['sentence_embedding'] for sentence_feature in sentence_features]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
            ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward
    output_states = self.auto_model(**trans_features, return_dict=False)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 820, in forward
    return self.transformer(
           ^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 585, in forward
    layer_outputs = layer_module(
                    ^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 529, in forward
    ffn_output = self.ffn(sa_output)  # (bs, seq_length, dim)
                 ^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 464, in forward
    return apply_chunking_to_forward(self.ff_chunk, self.chunk_size_feed_forward, self.seq_len_dim, input)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/pytorch_utils.py", line 242, in apply_chunking_to_forward
    return forward_fn(*input_tensors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 468, in ff_chunk
    x = self.activation(x)
        ^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/activations.py", line 78, in forward
    return self.act(input)
           ^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.35 GiB. GPU 0 has a total capacty of 79.35 GiB of which 370.12 MiB is free. Process 65810 has 7.90 GiB memory in use. Including non-PyTorch memory, this process has 71.08 GiB memory in use. Of the allocated memory 62.95 GiB is allocated by PyTorch, and 6.85 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

The above exception was the direct cause of the following exception:

[36mray::DefaultActor.run()[39m (pid=68178, ip=10.128.9.202, actor_id=361715b4e385284548c15d6401000000, repr=<flwr.simulation.ray_transport.ray_actor.DefaultActor object at 0x2aab5339a350>)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 84, in run
    raise ClientException(str(message)) from ex
flwr.simulation.ray_transport.ray_actor.ClientException: 
>>>>>>>A ClientException occurred.('\n\tSomething went wrong when running your client workload.\n\tClient 10 crashed when the DefaultActor was running its workload.\n\tException triggered on the client side: Traceback (most recent call last):\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_actor.py", line 72, in run\n    job_results = job_fn(client)\n                  ^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/simulation/ray_transport/ray_client_proxy.py", line 191, in fit\n    return maybe_call_fit(\n           ^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/client.py", line 223, in maybe_call_fit\n    return client.fit(fit_ins)\n           ^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/flwr/client/numpy_client.py", line 227, in _fit\n    results = self.numpy_client.fit(parameters, ins.config)  # type: ignore\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 123, in fit\n    self.net, val_results, test_results = _trainTransformer(\n                                          ^^^^^^^^^^^^^^^^^^\n  File "/home/waris/Github/fl-gptcache/utils/FlowerClient.py", line 45, in _trainTransformer\n    model.fit(\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/SentenceTransformer.py", line 721, in fit\n    loss_value = loss_model(features, labels)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in forward\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/losses/OnlineContrastiveLoss.py", line 42, in <listcomp>\n    embeddings = [self.model(sentence_feature)[\'sentence_embedding\'] for sentence_feature in sentence_features]\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/container.py", line 215, in forward\n    input = module(input)\n            ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/sentence_transformers/models/Transformer.py", line 66, in forward\n    output_states = self.auto_model(**trans_features, return_dict=False)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 820, in forward\n    return self.transformer(\n           ^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 585, in forward\n    layer_outputs = layer_module(\n                    ^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 529, in forward\n    ffn_output = self.ffn(sa_output)  # (bs, seq_length, dim)\n                 ^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 464, in forward\n    return apply_chunking_to_forward(self.ff_chunk, self.chunk_size_feed_forward, self.seq_len_dim, input)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/pytorch_utils.py", line 242, in apply_chunking_to_forward\n    return forward_fn(*input_tensors)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/models/distilbert/modeling_distilbert.py", line 468, in ff_chunk\n    x = self.activation(x)\n        ^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "/home/waris/.conda/envs/llm/lib/python3.11/site-packages/transformers/activations.py", line 78, in forward\n    return self.act(input)\n           ^^^^^^^^^^^^^^^\ntorch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.35 GiB. GPU 0 has a total capacty of 79.35 GiB of which 370.12 MiB is free. Process 65810 has 7.90 GiB memory in use. Including non-PyTorch memory, this process has 71.08 GiB memory in use. Of the allocated memory 62.95 GiB is allocated by PyTorch, and 6.85 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\n',)
slurmstepd: error: *** JOB 1934014 ON tc-gpu002 CANCELLED AT 2024-01-09T20:19:26 ***
